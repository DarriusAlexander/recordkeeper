!function(e){"use strict";NelioContent.hasSocialProfiles=!!NelioContent.hasSocialProfiles;var t=NelioContent.i18n.locale.toLowerCase().replace("_","-"),n=t;n.indexOf("-")>0&&(n=n.substr(0,n.indexOf("-"))),e.fn.ncselect2.defaults.set("language",n),_.contains(ncmoment.locales(),t)?ncmoment.updateLocale(t,{calendar:{lastDay:NelioContent.i18n.dates.lastDay,sameDay:NelioContent.i18n.dates.sameDay,nextDay:NelioContent.i18n.dates.nextDay,lastWeek:NelioContent.i18n.dates.lastWeek,nextWeek:NelioContent.i18n.dates.nextWeek,sameElse:NelioContent.i18n.dates["default"]},week:{dow:NelioContent.i18n.startOfWeek}}):_.contains(ncmoment.locales(),n)&&ncmoment.updateLocale(n,{calendar:{lastDay:NelioContent.i18n.dates.lastDay,sameDay:NelioContent.i18n.dates.sameDay,nextDay:NelioContent.i18n.dates.nextDay,lastWeek:NelioContent.i18n.dates.lastWeek,nextWeek:NelioContent.i18n.dates.nextWeek,sameElse:NelioContent.i18n.dates["default"]},week:{dow:NelioContent.i18n.startOfWeek}}),NelioContent.misc.nonReferenceDomains=_.map(NelioContent.misc.nonReferenceDomains,function(e){return e=e.replace(/\./g,"\\."),e=e.replace(/\*$/,"[^/]+"),e=e.replace(/\*/g,"[^/]*"),e=new RegExp("^[^:]+://[^/]*"+e)}),function(){NelioContent.models.Model=Backbone.Model.extend({clearToDefaults:function(){var e={silent:!0};return this.clear(e),"function"==typeof this.defaults?this.set(this.defaults(),e):this.set(this.defaults,e),this},sync:function(e,t,n){return n=n||{},n.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer "+NelioContent.apiAuthToken)},Backbone.Model.prototype.sync.apply(this,arguments)}}),NelioContent.collections.Collection=Backbone.Collection.extend({sync:function(e,t,n){return n=n||{},n.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer "+NelioContent.apiAuthToken)},Backbone.Collection.prototype.sync.apply(this,arguments)}}),NelioContent.helpers.getTemplate=function(e){var t=document.getElementById(e);return t?NelioContent.helpers.template(t.innerHTML):(console.warn("Template «"+e+"» not found. Using empty template."),NelioContent.helpers.template(""))},NelioContent.helpers.template=function(e){return _.template(NelioContent.helpers.trim(e),{evaluate:/\[\*([\s\S]+?)\*\]/g,interpolate:/\[\*=([\s\S]+?)\*\]/g,escape:/\[\*~([\s\S]+?)\*\]/g})}}(),function(e){var t=-1;NelioContent.helpers.refreshAuthToken=function(t,n){e.ajax({url:ajaxurl,data:{action:"nelio_content_get_api_auth_token"},success:function(e){NelioContent.apiAuthToken=e,"function"==typeof t&&t()},error:function(e){"function"==typeof n&&n(e)}})},NelioContent.helpers.isSubscribed=function(){return"none"!==NelioContent.subscription},NelioContent.helpers.getWindowWidth=function(){return e(window).width()},NelioContent.helpers.getScrollbarWidth=function(){if(t>=0)return t;var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var n=e.offsetWidth;e.style.overflow="scroll";var i=document.createElement("div");i.style.width="100%",e.appendChild(i);var o=i.offsetWidth;return e.parentNode.removeChild(e),t=n-o},NelioContent.helpers.openPopup=function(e,t,n){var i="undefined"!=typeof window.screenLeft?window.screenLeft:screen.left,o="undefined"!=typeof window.screenTop?window.screenTop:screen.top,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,r=s/2-t/2+i,l=a/2-n/2+o,c=window.open(e,"","width="+t+", height="+n+", top="+l+", left="+r);return window.focus&&c.focus(),c},NelioContent.helpers.addStyle=function(e){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n)},NelioContent.helpers.callAndDebounce=function(e,t,n){"number"!=typeof n&&(n=0);var i=!1,o=function(){e(),i=!0};0===n?o():setTimeout(o,n);var s=_.debounce(e,t),a=function(){i&&s()};return a},NelioContent.helpers.getParamFromUrl=function(e,t){arguments.length<2&&(t=e,e=window.location.href);var n=e.split("?"),i=n[1]||"";i=i.split("&");for(var o=0;o<i.length;++o){var s=i[o];if(s===t)return"";if(0===s.indexOf(t+"="))return s.replace(t+"=","")}},NelioContent.helpers.addParamInUrl=function(e,t,n){var i=!1;arguments.length<3&&(n=t,t=e,e=window.location.href,i=!0);var o=e.split("?");e=o[0];var s=o[1]||"";s=s.split("&");var a;for(a=0;a<s.length;++a){var r=s[a];if(r===t||0===r.indexOf(t+"="))break}return"undefined"==typeof n?s[a]=t:s[a]=t+"="+encodeURIComponent(n),s.length>0&&(e+="?"+s.join("&")),i&&"function"==typeof history.replaceState&&history.replaceState(null,null,e),e},NelioContent.helpers.removeParamFromUrl=function(e,t){var n=!1;arguments.length<2&&(t=e,e=window.location.href,n=!0);var i=t;"string"==typeof i&&(i=[t]);var o=e.split("?");e=o[0];var s=o[1]||"";s=s.split("&");for(var a=0;a<s.length;++a)for(var r=s[a],l=0;l<i.length;++l)t=i[l],r!==t&&0!==r.indexOf(t+"=")||(s[a]=void 0);return s.length>0&&(e+="?"+s.join("&").replace(/&+/g,"&").replace(/^&|&$/g,"")),n&&"function"==typeof history.replaceState&&history.replaceState(null,null,e),e},NelioContent.helpers.getSelection=function(e){if("undefined"!=typeof document.selection){e.focus();var t=document.selection.createRange();return t.text}if(void 0!==e.selectionStart){var n=e.selectionStart,i=e.selectionEnd;return e.value.substring(n,i)}return""},NelioContent.helpers.getAbsoluteUrl=function(e){return/^\/\//.test(e)?"http:"+e:"/"===e[0]?NelioContent.blogUrl.replace(/^((https?:)?\/\/[^\/]+).*$/,"$1")+e:e}}(jQuery),function(){function e(t){if("BR"===t.tagName)return"\n";var n=[].slice.call(t.childNodes);if(!n.length){var i=t.textContent||t.innerText||"";return"PRE"!==t.tagName&&(i=i.replace(/\r?\n/g,"")),i}return n.reverse(),_.reduce(n,function(t,n){var i=e(n);switch(n.tagName){case"OL":case"P":case"UL":/^\n/.test(t)||(t="\n\n"+t),/^\n\n/.test(t)||(t="\n"+t);break;case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"DIV":case"H1":case"H2":case"H3":case"H4":case"H5":case"LI":case"P":/^\n/.test(t)||(t="\n"+t)}return i+t},"")}NelioContent.helpers.trim=function(e){return"string"!=typeof e?e:e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},NelioContent.helpers.capitalizeFirstLetter=function(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},NelioContent.helpers.strongify=function(e,t){t=t.replace("\\",""),t=t.replace(".","\\.");var n=new RegExp(t,"gi");return e.replace(n,"<strong>$&</strong>")},NelioContent.helpers.getTweetLength=function(e){return e=e.replace(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g,"aa"),twttr.txt.getTweetLength(e)};var t=document.createElement("div");NelioContent.helpers.decodeHTMLEntities=function(e){return"string"!=typeof e?"":(e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),e=e.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),t.innerHTML=e,e=t.textContent,NelioContent.helpers.trim(e))},NelioContent.helpers.extractFirstLetter=function(e){var t=latinize(e.toLowerCase()).replace(/[^a-z]/g,"");return t.length>0?t.substring(0,1):"unknown"};var n=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;NelioContent.helpers.isEmail=function(e){return n.test(e)},NelioContent.helpers.processHtml=function(t){function n(e){for(var t=0;t<e.length&&e[t];){var n=e[t];n.parentNode?n.parentNode.removeChild(n):++t}}var i=document.createElement("div");i.innerHTML=t;var o=NelioContent.helpers.extractShareBlockIds(i.getElementsByTagName("ncshare")),s=_.map(o,function(e){var t=i.querySelectorAll("ncshare."+e),n=_.reduce(t,function(e,t){return e+(t.textContent||t.innerText)},""),o=_.reduce(t,function(e,t){return e+t.innerHTML},"");return{text:NelioContent.helpers.trim(n),html:NelioContent.helpers.trim(o)}});return n(i.getElementsByTagName("script")),n(i.getElementsByTagName("link")),n(i.getElementsByTagName("figcaption")),n(i.getElementsByTagName("caption")),n(i.getElementsByTagName("img")),n(i.getElementsByTagName("pre")),n(i.querySelectorAll("li li")),n(_.filter(i.getElementsByTagName("code"),function(e){if(!e.parentNode)return!1;var t=NelioContent.helpers.trim(e.textContent||e.innerText),n=NelioContent.helpers.trim(e.parentNode.textContent||e.parentNode.innerText);return t===n})),_.each(i.getElementsByTagName("a"),function(e){e.textContent='<a href="'+e.getAttribute("href")+'">'+e.textContent+"</a>"}),{clean:e(i),highlights:_.uniq(s),top:_.union(_.map(i.getElementsByTagName("h1"),function(e){return e.textContent||e.innerText}),_.map(i.getElementsByTagName("h2"),function(e){return e.textContent||e.innerText}),_.map(i.getElementsByTagName("h3"),function(e){return e.textContent||e.innerText}),_.map(i.getElementsByTagName("strong"),function(e){return e.textContent||e.innerText}))}},NelioContent.helpers.htmlToText=function(t){var n=document.createElement("div");n.innerHTML=t;try{return e(n).replace(/\n\+$/,"")}catch(i){return n.textContent||n.innerText}}}(),function(e){e.widget("ui.dialogS2",e.ui.dialog,{_allowInteraction:function(e){return!0}}),NelioContent.helpers.openDeletionConfirmationDialog=function(t,n,i,o){var s=e("<div>"+n+"</div>");return s.dialog({title:t,modal:!0,width:Math.min(500,e(window).width()-20),dialogClass:"nc-dialog",buttons:[{"class":"button nc-cancel-button",text:NelioContent.i18n.actions.cancel,click:function(){s.dialog("close")}},{"class":"button nc-super-delete-button",text:i,click:function(){o()}}]}),s},NelioContent.helpers.openConfirmationDialog=function(t,n,i,o){var s=e("<div>"+n+"</div>");return s.dialog({title:t,modal:!0,width:Math.min(500,e(window).width()-20),dialogClass:"nc-dialog",buttons:[{"class":"button nc-cancel-button",text:NelioContent.i18n.actions.cancel,click:function(){s.dialog("close")}},{"class":"button button-primary",text:i,click:function(){o()}}]}),s},NelioContent.helpers.openDialog=function(t,n){var i=e(n);return i.dialog({title:t,modal:!0,width:Math.min(500,e(window).width()-20),dialogClass:"nc-dialog",buttons:[{"class":"button nc-cancel-button",text:NelioContent.i18n.actions.ok,click:function(){i.dialog("close"),i.dialog("destroy")}}]}),i};var t=[];NelioContent.helpers.openWarningDialog=function(n,i){i='<span class="nc-dashicons nc-dashicons-warning"></span> '+i;var o=e('<div class="nc-error-dialog">'+i+"</div>");o.dialog({title:n,modal:!0,autoOpen:!1,width:Math.min(500,e(window).width()-20),dialogClass:"nc-dialog",buttons:[{"class":"button nc-cancel-button",text:NelioContent.i18n.actions.ok,click:function(){o.dialog("close"),o.dialog("destroy")}}],close:function(){t.shift(),t.length&&t[0].dialog("open")}}),t.push(o),t[0]===o&&o.dialog("open")},NelioContent.helpers.openErrorDialog=function(e){NelioContent.helpers.openWarningDialog(NelioContent.i18n.titles.error,e)},NelioContent.helpers.makeDialogButton=function(t,n,i,o){var s="button";return o&&(s="button button-primary"),{"class":s+" nc-"+n+"-button",text:i,click:function(i){var o=i.target||i.srcElement,s=e(o).closest("button");s.hasClass("button-disabled")||t.trigger("nc:click:dialog:"+n,i)}}},NelioContent.helpers.makeDialogSaveButton=function(e,t){return NelioContent.helpers.makeDialogButton(e,"save",t,!0)},NelioContent.helpers.makeDialogCancelButton=function(e,t){return NelioContent.helpers.makeDialogButton(e,"cancel",t)},NelioContent.helpers.makeDialogDeleteButton=function(e,t){return NelioContent.helpers.makeDialogButton(e,"delete",t)},NelioContent.helpers.makeWarningTooltip=function(e){"undefined"!=typeof e&&0!==e.length&&e.tooltip({position:{my:"right bottom",at:"right+5 top-5"},tooltipClass:"nc_tooltip nc_warning_tooltip",show:!1,hide:!1})},NelioContent.helpers.makeInfoTooltip=function(e){"undefined"!=typeof e&&0!==e.length&&e.tooltip({position:{my:"center top",at:"center bottom+10"},tooltipClass:"nc_tooltip",show:!1,hide:!1})},NelioContent.helpers.startPointerTour=function(t,n){function i(){return l&&l.pointer("destroy"),c<=1?(c=0,void o()):(r=t[c-2],--c,l=e(r.target),l||i(),void s())}function o(){return l&&l.pointer("close"),c>=t.length?void("function"==typeof n&&n()):(r=t[c],++c,l=e(r.target),l||o(),void s())}function s(){var n=r.title;t.length>1&&(n+=" ("+c+"/"+t.length+")"),l.pointer({content:"<h3>"+n+"</h3>"+r.content,buttons:a,position:r.position}),l&&(l.pointer("open"),setTimeout(function(){var t=e(window),n=l.offset(),i=t.scrollTop(),o=window.innerHeight,s=n.top,a=n.bottom;i<=s&&a<o||(s-=Math.round(Math.min(400,o/2)),e("html, body").animate({scrollTop:s},500))},50))}function a(){var e='<a class="nc-previous" href="#">'+_.escape(NelioContent.i18n.actions.previous)+"</a>";c<=1&&(e="");var n='<a class="nc-next" href="#">'+_.escape(NelioContent.i18n.actions.next)+"</a>";c===t.length&&(n='<a class="close" href="#">'+_.escape(NelioContent.i18n.actions.close)+"</a>");var s=jQuery('<div class="nc-buttons">'+e+n+"</div>");return s.find("a.nc-previous").on("click",function(e){e.preventDefault(),i()}),s.find("a:not( .nc-previous )").on("click",function(e){e.preventDefault(),o()}),s}var r,l,c=0;o()}}(jQuery),function(e){NelioContent.helpers.selectImage=function(e){"undefined"==typeof e&&(e={}),"function"!=typeof e.onSelection&&(e.onSelection=function(){});var t=wp.media.frames.shareImageFrame=wp.media({title:NelioContent.i18n.titles.selectImage,button:{text:NelioContent.i18n.actions.choose},multiple:!1});t.on("select",function(){var n=t.state().get("selection").first().toJSON();e.onSelection(n)}),"number"==typeof e.image&&t.on("open",function(){var n=wp.media.attachment(e.image);t.state().get("selection").add(n)}),"function"==typeof e.onClose&&t.on("close",e.onClose),t.open()}}(jQuery),function(e){var t=/[12][0-9][0-9][0-9]-[01][0-9]-[0-3][0-9]/,n=/[012][0-9]:[0-5][0-9]/;window.ncLocalizeMoment=function(e,t){return"undefined"==typeof t&&(t=NelioContent.i18n.timezone),t.indexOf(":")>0?e.utcOffset(t):e.tz(t),e},window.ncNewLocalMoment=function(e,t){return"string"==typeof e&&""!==NelioContent.helpers.trim(e)||(e=ncLocalizeMoment(ncmoment()).format("YYYY-MM-DD HH:mm")),/^[0-9]{4}.[0-9]{2}.[0-9]{2}/.test(e)&&!/^[0-9]{4}.[0-9]{2}.[0-9]{2}.[0-9]{2}:[0-9]/.test(e)&&(e=NelioContent.helpers.trim(e)+" 12:00"),"undefined"==typeof t&&(t=NelioContent.i18n.timezone),t.indexOf(":")>0?ncLocalizeMoment(ncmoment(e+t),t):ncLocalizeMoment(ncmoment.tz(e,t),t)},NelioContent.helpers.isDate=function(e){return t.test(e)},NelioContent.helpers.isTime=function(e){return n.test(e)},NelioContent.helpers.getTimeInterval=function(e){var t,n,i;switch(e){case"all":t=void 0,n=void 0;break;case"month-to-date":t=ncmoment().date(1).format("YYYY-MM-DD"),n=ncmoment().format("YYYY-MM-DD");break;case"last-30-days":t=ncmoment().add(-30,"days").format("YYYY-MM-DD"),n=ncmoment().format("YYYY-MM-DD");break;case"last-month":i=ncmoment().add(-1,"months"),t=i.startOf("month").format("YYYY-MM-DD"),n=i.endOf("month").format("YYYY-MM-DD");break;case"year-to-date":t=ncmoment().startOf("year").format("YYYY-MM-DD"),n=ncmoment().format("YYYY-MM-DD");break;case"last-12-months":t=ncmoment().add(-12,"months").format("YYYY-MM-DD"),n=ncmoment().format("YYYY-MM-DD");break;case"last-year":i=ncmoment().add(-1,"years"),t=i.startOf("year").format("YYYY-MM-DD"),n=i.endOf("year").format("YYYY-MM-DD")}return{from:t,to:n,mode:e}}}(jQuery),function(e){function t(e){if(_.indexOf(s,e)!==-1)return!0;var t=n(e);if(t.length>0&&_.indexOf(a,t)!==-1)return!1;var i=_.reduce(NelioContent.misc.nonReferenceDomains,function(t,n){return t||n.test(e)},!1);return!i&&(s.push(e),!0)}function n(e){var t=e.indexOf("?");if(-1!==t&&(e=e.substring(0,t)),/^https?:\/\//i.test(e)){e=e.replace(/^https?:\/\//i,"");var n=e.indexOf("/");if(-1===n)return"";e=e.substring(n,e.length)}var i=e.substring(Math.max(0,e.length-6),e.length),o=i.indexOf(".");return-1!==o?i.substring(o+1,i.length).toLowerCase():""}var i=/<a[^>]+href=("[^"]*"|'[^']*')/gi,o=/<img[^>]+src=("[^"]*"|'[^']*')/gi,s=[],a=["jpg","png","tif","bmp","svg","pgm","pbm","pnm","hdr","bpg","cpt","psd","psp","xcf","ppm","dwf","dwg","dxf","jpeg","tiff","webp","heif","mkv","flv","avi","mov","vob","ogv","ogg","drc","mng","mov","wmv","yuv","asf","mp4","m4p","m4v","mpg","mpe","mpv","mp2","m2v","m4v","svi","3gp","3g2","mxf","roq","nsv","f4v","f4p","f4a","f4b","rm","qt","webm","gifv","rmvb","mpeg","zip","rar","3ds","x3d","xgl","pub","7z","po","pot","js","css","scss"];NelioContent.helpers.countImages=function(e){var t=e.match(o);return"undefined"==typeof t||null===t?0:t.length},NelioContent.helpers.extractReferences=function(e){for(var n,o=[];n=i.exec(e);){var s=n[1];s=s.substring(1,s.length-1),t(s)&&!_.contains(o,s)&&o.push(s)}return o},NelioContent.helpers.isExternalReference=function(e){var t=/^[a-zA-Z]+:\/\//,n=NelioContent.blogUrl.toLowerCase().replace(/^https:/,"http:");return e=e.toLowerCase().replace("https","http"),e.indexOf(n)===-1&&t.test(e)}}(jQuery),function(e){NelioContent.helpers.buildPostFilter=function(t,n){"undefined"==typeof n&&(n=!1),"remove-none-option"===n&&t.find("option[value=none]").remove();var i;t.ncselect2({width:"15em",templateSelection:function(t){switch(t.id){case"all":return NelioContent.postTypes.length>1?NelioContent.i18n.filters.selection.allPostTypes:NelioContent.postTypes[0].labels.allItems;case"none":return i='<span class="nc-dashicons nc-dashicons-hidden"></span> ',e(1===NelioContent.postTypes.length&&"post"===NelioContent.postTypes[0].name?"<span>"+i+NelioContent.i18n.filters.selection.noPosts+"</span>":"<span>"+i+NelioContent.i18n.filters.selection.noPostTypes+"</span>");default:return i="post"===t.id?'<span class="nc-dashicons nc-dashicons-admin-post"></span> ':"page"===t.id?'<span class="nc-dashicons nc-dashicons-admin-page"></span> ':'<span class="nc-dashicons nc-dashicons-marker"></span> ',e("<span>"+i+t.text+"</span>")}}})}}(jQuery),setInterval(NelioContent.helpers.refreshAuthToken,6e5),NelioContent.models.User=Backbone.Model.extend({defaults:{email:"",name:NelioContent.i18n.errors.generic.unknownUserName,photo:"",role:"subscriber",loading:!1,existsInWordPress:!0},initialize:function(){this.listenTo(this,"change:name",this._setFirstLetter),this._setFirstLetter()},loadData:function(){if(!this.get("loading")){if(!this.get("id"))return this.set("loading",!1),void this.set("existsInWordPress",!1);this.set("loading",!0);var t=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_get_user",user:t.get("id")},success:function(e){e.loading=!1,e.existsInWordPress=!0,t.set(e),t.trigger("nc:load")},error:function(){var e={loading:!1,existsInWordPress:!1};t.set(e),t.trigger("nc:load:error")}})}},valid:function(){return!this.get("loading")&&this.get("existsInWordPress")},isLoading:function(){return this.get("loading")},_setFirstLetter:function(){var e=this.get("name");e===NelioContent.i18n.errors.generic.unknownUserName&&(e=""),this.set("firstLetter",NelioContent.helpers.extractFirstLetter(e))}}),NelioContent.collections.Users=Backbone.Collection.extend({model:NelioContent.models.User,current:function(){return this.get(NelioContent.userId)},getUser:function(e){var t=this.get(e);return"undefined"==typeof t&&(t=new NelioContent.models.User({id:e}),t.loadData(),this.add(t)),t}}),NelioContent.users=new NelioContent.collections.Users(NelioContent.users),NelioContent.models.AjaxError=Backbone.Model.extend({defaults:function(){return{code:0,message:""}},initialize:function(){},parseResponse:function(e){var t=503,n=NelioContent.i18n.errors.api.emptyAjaxStatus;0!==e.status&&(t=e.status),"string"==typeof e.responseJSON&&(n=e.responseJSON),this.set("code",t),this.set("message",n)}}),NelioContent.models.Post=Backbone.Model.extend({defaults:function(){return{id:0,type:NelioContent.postTypes[0].name,status:"draft",calendarKind:"post",title:"",excerpt:"",editLink:"",permalink:"",categories:[],titleFormatted:"",excerptFormatted:"",author:0,autoImage:"",imageId:0,image:"",date:!1,statistics:!1,followers:[],socialQueueError:!1,timeSinceLastShare:!1,publishCount:"&ndash;",scheduleCount:!1}},initialize:function(){this.listenTo(this,"change:permalink",this._fixPermalink),this._fixPermalink(),this.listenTo(this,"change:id",this._fixPostIdType),this._fixPostIdType(),this.listenTo(this,"change:imageId",this._fixImageIdType),this._fixImageIdType(),this.listenTo(this,"change:date",this._fixDateFormat),this._fixDateFormat(),this.listenTo(this,"change:title",this._escapeTitle),this.listenTo(this,"change:excerpt",this._escapeExcerpt),this._maybeUnescapeTitleAndExcerpt(),"post"===this.get("type")&&0===this.get("categories").length&&this.set("categories",[NelioContent.categories[0].id])},isPublished:function(){return"publish"===this.get("status")},isScheduled:function(){return!this.isPublished()&&!(!this.get("date")||!ncNewLocalMoment().isBefore(this.get("date")))},getDateForSorting:function(){return this.get("date").format("YYYY-MM-DDTHH:mm")},getRelevantDay:function(){return!!this.get("date")&&this.get("date").format("YYYY-MM-DD")},reschedule:function(t){if(this.get("date")&&this.get("date").format("YYYY-MM-DD")===t)return void this.trigger("nc:abort:reschedule");var n=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_reschedule_post",post:this.get("id"),date:t},success:function(e){n.set(e),n.trigger("nc:reschedule")},error:function(e){n.trigger("nc:error",e.responseJSON)}})},isLoading:function(){return this.get("loading")},trash:function(){var t=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_trash_post",post:this.get("id")},success:function(){t.trigger("nc:trash")},error:function(e){t.trigger("nc:error",e.responseJSON)}})},_fixPostIdType:function(){this.stopListening(this,"change:id",this._fixPostIdType);var e=this.get("id");"string"==typeof e&&(e=parseInt(e),isNaN(e)?(this.set("id",0),this.set("status","draft"),this.set("title",""),this.set("permalink",""),this.set("excerpt","")):this.set("id",e)),this.listenTo(this,"change:id",this._fixPostIdType)},_fixImageIdType:function(){this.stopListening(this,"change:imageId",this._fixImageIdType);var e=this.get("imageId");e=parseInt(e),isNaN(e)||this.set("imageId",e),this.listenTo(this,"change:imageId",this._fixImageIdType)},_fixDateFormat:function(){var e=this.get("date");"string"==typeof e&&this.set("date",ncNewLocalMoment(e))},_fixPermalink:function(){if(""!==NelioContent.helpers.trim(NelioContent.blogUrl)){var e=this.get("permalink");"undefined"!=typeof e&&""!==NelioContent.helpers.trim(e)||(e=NelioContent.blogUrl),this.set("permalink",NelioContent.helpers.getAbsoluteUrl(e))}},_escapeTitle:function(){this.set("titleFormatted",_.escape(this.get("title")))},_escapeExcerpt:function(){this.set("excerptFormatted",_.escape(this.get("excerpt")))},_maybeUnescapeTitleAndExcerpt:function(){var e=this.get("title");"undefined"!=typeof e&&0!==NelioContent.helpers.trim(e).length||this.set("title",NelioContent.helpers.decodeHTMLEntities(this.get("titleFormatted")));var t=this.get("excerpt");"undefined"!=typeof t&&0!==NelioContent.helpers.trim(t).length||this.set("excerpt",NelioContent.helpers.decodeHTMLEntities(this.get("excerptFormatted")))}}),NelioContent.models.SocialMessage=NelioContent.models.Model.extend({urlRoot:NelioContent.apiUri+"/social",defaults:function(){return{siteId:"",profileId:"",targetName:"default",targetDisplayName:"",profiles:[],network:"twitter",networkKind:"single",calendarKind:"social",type:"text",status:"draft",source:"manual",isFreePreview:!1,postId:0,postType:NelioContent.postTypes[0].name,baseDatetime:"none",dateType:"predefined-offset",dateValue:"0",timeType:"predefined-offset",timeValue:"0",timezone:NelioContent.i18n.timezone,schedule:ncNewLocalMoment(),text:"",textComputed:"",mentions:[],image:"",imageId:0,sent:!1,sentTime:0,sentResponse:"",sentAttempts:0,nextAttemptTimestamp:0,failureDescription:"",url:"",_previewUrl:"",timestamp:0}},post:void 0,initialize:function(){this.post=new NelioContent.models.Post,this.listenTo(this,"change:text",this._updateTextLengthInAllNetworks),this.listenTo(this,"change:text",this._computeText),this._computeText(),this.listenTo(this,"change:network",this._updateActiveNetworkMetas),this.listenTo(this,"change:profiles",this._updateActiveNetworkMetas),this._updateActiveNetworkMetas(),this.listenTo(this,"change:textComputed",this._extractRelevantUrl),this.listenTo(this,"change:network",this._extractRelevantUrl),this._extractRelevantUrl(),this.listenTo(this,"change:profileId",this._fixProfileInformation),this._fixProfileInformation(),this.listenTo(this,"change:schedule",this._fixScheduleFormat),this._fixScheduleFormat(),this.listenTo(this,"change:dateValue",this._fixSchedule),this.listenTo(this,"change:timeValue",this._fixSchedule),this.listenTo(this,"change:postId",this._setDefaultText),this.listenTo(this,"change:dateType",this._setBaseDatetime),this._setBaseDatetime(),this.listenTo(this,"change:image",this._fixImageUrl),this._fixImageUrl(),this.listenTo(this,"change:auto",this._maybeFixSource),this._maybeFixSource()},setPost:function(e){this.stopListening(this.post),this.post=e,this.set("postId",this.post.get("id")),this.set("postType",this.post.get("type")),this._setBaseDatetime(),this._fixSchedule(),this.listenTo(this.post,"change:dateType",this._setBaseDatetime),this.trigger("change:text"),this.trigger("change:textComputed")},loadPost:function(){if(0===this.get("postId"))return void this.trigger("nc:load:post");if(this.get("postId")===this.post.get("id"))return void this.trigger("nc:load:post");var t=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_get_post",post:this.get("postId")},success:function(e){t.setPost(new NelioContent.models.Post(e)),t.trigger("nc:load:post")},error:function(e){t.trigger("nc:error:post",e.responseJSON)}})},getTextLength:function(){var e=this._getRelevantNetworkForTextLength();return this.__textLengthPerNetwork[e].value},getMaxTextLength:function(){var e=this._getRelevantNetworkForTextLength();return this.__textLengthPerNetwork[e].max},isTextTooLong:function(){return this.getTextLength()>this.getMaxTextLength()},getDateForSorting:function(){var e="";if(this.post.isPublished()||this.post.isScheduled()){var t=this.get("schedule");e+=t.format("YYYY-MM-DDTHH:mm")}else{if("exact"===this.get("dateType"))e+=this.get("dateValue");else{var n="Z0000000"+this.get("dateValue");e+=n.substr(n.length-6)}if("exact"===this.get("timeType"))e+=this.get("timeValue");else{var i="Z0000000"+this.get("timeValue");e+=i.substr(i.length-6)}}return e.toLowerCase()},getRelevantDay:function(){return this.get("schedule").format("YYYY-MM-DD")},isSomethingMissing:function(){if(NelioContent.helpers.trim(this.get("text"))<=0)return NelioContent.i18n.errors.socialMessage.noMessage;if(this.isTextTooLong())return NelioContent.i18n.errors.socialMessage.messageTooLong;if(this.isNew()&&this.get("profiles").length<=0)return NelioContent.i18n.errors.socialMessage.noProfiles;var e,t=!1;if(this.isNew()?_.each(this.get("profiles"),function(n){e=NelioContent.profiles.get(n.id),"undefined"!=typeof e&&(t=t||e.requiresImageToShare())}):(e=NelioContent.profiles.get(this.get("profileId")),"undefined"!=typeof e&&(t=e.requiresImageToShare())),t&&"image"!==this.get("type"))return this.isNew()&&this.get("profiles").length>1?NelioContent.i18n.errors.socialMessage.noImageMultiple:NelioContent.i18n.errors.socialMessage.noImageSingle;if(NelioContent.helpers.trim(this.get("targetName"))<=0)return NelioContent.i18n.errors.socialMessage.noTarget;if("exact"===this.get("dateType")){if(!NelioContent.helpers.isDate(this.get("dateValue")))return NelioContent.i18n.errors.datetime.invalidDate}else if(""===NelioContent.helpers.trim(this.get("dateValue")))return NelioContent.i18n.errors.datetime.noDate;if("exact"===this.get("timeType")){if(!NelioContent.helpers.isTime(this.get("timeValue")))return NelioContent.i18n.errors.datetime.invalidTime}else if(""===NelioContent.helpers.trim(this.get("timeValue")))return NelioContent.i18n.errors.datetime.noTime;var n,i;if("exact"===this.get("dateType")){if("exact"===this.get("timeType"))i=this.get("timeValue");else if("time-interval"===this.get("timeType"))switch(this.get("timeValue")){case"night":i="23:00";break;case"afternoon":i="19:00";break;case"noon":i="15:00";break;default:i="11:00"}else i="12:00";if(n=this.get("dateValue")+" "+i,n=ncNewLocalMoment(n),n.isBefore(ncNewLocalMoment()))return NelioContent.i18n.errors.datetime.noPastAllowed}return!(0!==this.post.get("id")&&!this.post.isPublished()||"0"!==this.get("dateValue")||"exact"!==this.get("timeType")||(n=ncNewLocalMoment().format("YYYY-MM-DD"),n=n+" "+this.get("timeValue"),n=ncNewLocalMoment(n),!ncNewLocalMoment().isAfter(n)))&&NelioContent.i18n.errors.datetime.noPastAllowed},reschedule:function(e){if(this.stopListening(this,"change:dateValue",this._fixSchedule),this.stopListening(this,"change:timeValue",this._fixSchedule),"exact"===this.get("dateType")){if(this.get("dateValue")===e)return void this.trigger("nc:abort:reschedule");this.set("dateValue",e);var t=this.get("schedule").format("HH:mm");this.set("schedule",e+" "+t)}else{var n=ncNewLocalMoment(this.get("schedule").format("YYYY-MM-DD")+"T12:00:00.000"),i=ncNewLocalMoment(e+"T12:00:00.000"),o=this.get("schedule").format("HH:mm"),s=i.diff(n,"d");if(0===s)return void this.trigger("nc:abort:reschedule");var a=parseInt(this.get("dateValue")),r=a+s;if(r<0)return void this.trigger("nc:abort:reschedule",{title:NelioContent.i18n.titles.invalidSocialScheduling,content:NelioContent.i18n.dialogs.invalidSocialScheduling});switch(r){case 0:this.set("dateType","predefined-offset"),this.set("dateValue","0");break;case 1:this.set("dateType","predefined-offset"),this.set("dateValue","1");break;default:this.set("dateType","positive-days"),this.set("dateValue",""+r)}0===a&&"exact"!==this.get("timeType")&&"time-interval"!==this.get("timeType")&&(this.set("timeType","exact"),this.set("timeValue",o)),this.get("schedule").add(s,"d")}this.set("baseDatetime","reschedule"),this.save(void 0,{success:function(e,t){var n=[];"undefined"!=typeof t.modifiedMessages&&(n=t.modifiedMessages,delete t.modifiedMessages),e.set(t),e._setBaseDatetime(),e.trigger("nc:reschedule",n)},error:function(e){e.trigger("nc:error")}}),this.listenTo(this,"change:dateValue",this._fixSchedule),this.listenTo(this,"change:timeValue",this._fixSchedule)},shareNow:function(){if("error"!==this.get("status"))return void this.trigger("nc:error");this.set("status","_awaitingEnqueueConfirmation");var t=this;e.ajax({url:NelioContent.apiUri+"/social/"+this.get("id")+"/retry",method:"PUT",headers:{Authorization:"Bearer "+NelioContent.apiAuthToken,"Content-Type":"application/json"},success:function(e){"schedule"===e.status&&(e.status="_enqueued"),t.set(e)},error:function(){t.set("status","_awaitingEnqueueConfirmation"),t.trigger("nc:error")}})},getHighlightedText:function(){return this._highlightText(this.get("textComputed"))},getPreviewText:function(){var e=this.get("text");return e=e.replace(/\{title\}/g,this.post.get("title")),e=e.replace(/\{permalink\}/g,this.post.get("permalink")),e=this._wrapMentionsInSpaces(e),this._highlightText(e)},getPreviewTextForCalendar:function(){var e=this.get("textComputed");return e=this._wrapMentionsInSpaces(e),e=this._highlightText(e),e=e.replace(/<br>/g," ")},addNewMention:function(e){var t=this.get("mentions"),n=_.reduce(t,function(t,n){return t||n.network===e.network&&n.networkId===e.networkId},!1);n||(t.push(e),this.set("mentions",t))},getEditableHtmlText:function(){var e=this.get("text").replace(/\n/g,"<br>"),t=this.get("mentions"),n=NelioContent.helpers.getTemplate("_nc-mention-in-editor");return _.each(t,function(t){var i;"facebook"===t.network?(i=new RegExp("@\\[facebook:"+t.networkId+"\\]","g"),e=e.replace(i,'<span contenteditable="false">'+n(t)+"</span>")):(i=new RegExp("@\\["+t.network+":"+t.username+"\\]","g"),e=e.replace(i,'<span contenteditable="false">'+n(t)+"</span>"))}),e},_wrapMentionsInSpaces:function(e){return e=" "+e+" ",e=e.replace(/([^\s])(@\[[a-z]+:[^\]]+\])/g,"$1 $2"),e=e.replace(/(@\[[a-z]+:[^\]]+\])([a-zA-Z0-9_])/g,"$1 $2"),
e=e.substring(1,e.length-1)},_highlightText:function(e){return e=" "+e+" ",e=e.replace(/\r\n/g,"\n"),e=e.replace(/\n/g," \n "),e=_.escape(e),e=e.replace(/ (https?:\/\/[^ ]+)/g,' <a class="nc-link">$1</a>'),e=e.replace(twttr.txt.regexen.validHashtag,' <span class="nc-hash">#$3</span>'),e=e.replace(/#([0-9]+)/g,' <span class="nc-num-hash">#$1</span>'),e=this._highlightRelevantMentionsInCurrentNetwork(e),e=this._expandMentions(e,this.get("network")),e=e.replace(/ \n /g,"\n"),e=e.replace(/\n/g,"<br>"),e=e.substring(1,e.length-1)},_highlightRelevantMentionsInCurrentNetwork:function(e){return"facebook"===this.get("network")?"page"===this.get("networkKind")&&(e=e.replace(/(@\[facebook:[0-9]+\])/g,'<span class="nc-mention">$1</span>')):(e=e.replace(/(@\[[a-z]+:[a-zA-Z0-9_]+\])/g,'<span class="nc-mention">$1</span>'),e=e.replace(twttr.txt.regexen.validMentionOrList,'$1<span class="nc-mention">$2$3</span>')),e},_expandMentions:function(e,t){var n;return _.each(this.get("mentions"),function(i){switch(i.network){case"facebook":n=new RegExp("@\\[facebook:"+i.networkId+"\\]","g"),e=e.replace(n,_.escape(i.displayName));break;case"twitter":"twitter"===t?(n=new RegExp("@\\[twitter:"+i.username+"\\]","g"),e=e.replace(n,"@"+i.username)):(n=new RegExp("@\\[twitter:"+i.username+"\\]","g"),e=e.replace(n,_.escape(i.displayName)));break;default:n=new RegExp("@\\["+i.network+":"+i.username+"\\]","g"),e=e.replace(n,"@"+i.username)}}),e},_updateActiveNetworkMetas:function(){var e=[];if(this.isNew()){var t=_.map(_.pluck(this.get("profiles"),"id"),function(e){var t=NelioContent.profiles.get(e);return t?t.toJSON():{network:!1}});e=_.uniq(_.pluck(t,"network"))}e.length||(e=[this.get("network")]);var n=_.filter(NelioContent.networkMetas,function(t){return _.contains(e,t.id)});this.__textLengthPerNetwork={},_.each(n,_.bind(function(e){this.__textLengthPerNetwork[e.id]={value:this._computeTextLengthIn(e.id),max:e.maxLength}},this))},_updateTextLengthInAllNetworks:function(){_.mapObject(this.__textLengthPerNetwork,_.bind(function(e,t){e.value=this._computeTextLengthIn(t)},this))},_computeTextLengthIn:function(e){var t;return 0<this.post.get("id")?(t=this.get("text"),t=t.replace(/\{title\}/g,this.post.get("title")),t=t.replace(/\{permalink\}/g,this.post.get("permalink"))):t=this.get("textComputed"),"image"===this.get("type")&&(t+=" https://neliosoftware.com/wp-content/image.jpg"),t=this._wrapMentionsInSpaces(t),t=this._expandMentions(t,e),NelioContent.helpers.getTweetLength(t)},_getRelevantNetworkForTextLength:function(){var e=!1,t=1/0;return _.mapObject(this.__textLengthPerNetwork,function(n,i){var o=n.max-n.value;o<t&&(t=o,e=i)}),e},_fixProfileInformation:function(){var e=NelioContent.profiles.get(this.get("profileId"));"undefined"!=typeof e&&(this.set("network",e.get("network")),this.set("networkKind",e.get("kind")))},_computeText:function(){var e=this.get("text");if(0===this.get("postId"))this.set("textComputed",e);else if(this.post.get("id")>0){e=e.replace(/\{permalink\}/g,this.post.get("permalink"));var t=this.post.get("title"),n=e.replace(/\{title\}/g,t);"image"===this.get("type")&&(n+=" https://neliosoftware.com/wp-content/image.jpg");var i=Math.max(NelioContent.helpers.getTweetLength(n)-this.getMaxTextLength(),0);i&&(t=t.slice(0,-i-1),t+="…"),e=e.replace(/\{title\}/g,t),this.set("textComputed",e)}},_extractRelevantUrl:function(){var e=" "+this.get("textComputed");0<this.post.get("id")&&(e=" "+this.get("text"),e=e.replace(/\n/g,"\n "),e=e.replace(/\{title\}/g,this.post.get("title")),e=e.replace(/\{permalink\}/g,this.post.get("permalink")));var t="",n=e.match(/ (https?:\/\/[^ ]+)/g);if(null===n)return this.post&&this.post.get("permalink")&&(t=this.post.get("permalink")),this.set("_previewUrl",""),void this.set("url",t);switch(this.get("network")){case"twitter":t=n[n.length-1];break;default:t=n[0]}t=NelioContent.helpers.trim(t),this.set("_previewUrl",t),this.set("url",t)},_fixSchedule:function(){if("publish"!==this.get("status")&&(!(this.get("postId")>0)||this.post.isPublished()||this.post.isScheduled())){var e;e=0===this.get("postId")||this.post.isPublished()?ncNewLocalMoment():this.post.get("date").clone();var t="";if("exact"===this.get("dateType")?t=this.get("dateValue"):(e.add(this.get("dateValue"),"d"),t=e.format("YYYY-MM-DD")),NelioContent.helpers.isDate(t))if("exact"===this.get("timeType")){if(!NelioContent.helpers.isTime(this.get("timeValue")))return;t+=" "+this.get("timeValue"),this.set("schedule",ncNewLocalMoment(t))}else if("time-interval"===this.get("timeType")){var n="08:00";switch(this.get("timeValue")){case"morning":n="09:00";break;case"noon":n="13:00";break;case"afternoon":n="17:00";break;case"night":n="21:00"}t+=" "+n,this.set("schedule",ncNewLocalMoment(t))}else e.add(this.get("timeValue"),"h"),this.set("schedule",e)}},_fixImageUrl:function(){var e=this.get("image");"string"==typeof e&&this.set("image",NelioContent.helpers.getAbsoluteUrl(e))},_maybeFixSource:function(){var e=this.get("source");if("undefined"==typeof e)switch(this.get("auto")){case"publication":this.set("source","publication-template");break;case"timeline":case"reshare":this.set("source","reshare-template");break;default:this.set("source","manual")}},_fixScheduleFormat:function(){var e=this.get("schedule");"string"==typeof e&&this.set("schedule",ncNewLocalMoment(e))},_setBaseDatetime:function(){0===this.post.get("id")||this.post.isPublished()?"exact"===this.get("dateType")?this.set("baseDatetime","none"):this.set("baseDatetime","now"):this.post.isScheduled()?"exact"===this.get("dateType")?this.set("baseDatetime","none"):this.set("baseDatetime",this.post.get("date").clone()):this.set("baseDatetime","none")},_setDefaultText:function(){var e=NelioContent.helpers.trim(this.get("text")),t=this.get("postId");t>0&&0===e.length&&this.set("text","{title} {permalink}")}}),NelioContent.models.Reference=Backbone.Model.extend({_lastMatchingRegExp:void 0,_regExps:[],defaults:{id:"",title:"",titleFormatted:"",url:"",urlFormatted:"",date:"",author:"",email:"",twitter:"",isInPostContent:!1,status:"pending",suggestionAdvisorDisplayName:"",suggestionAdvisorId:-1,suggestionDate:"",isExternal:!0},initialize:function(){this._lastMatchingRegExp=/a^/,this._generateRegExps(),this.listenTo(this,"change:url",this._generateRegExps),this.listenTo(this,"change",this._escapeFields),this._escapeFields()},isSomethingMissing:function(){var e=this.get("url");if("undefined"==typeof e||0===NelioContent.helpers.trim(e).length)return NelioContent.i18n.errors.reference.noUrl;var t=this.get("twitter");if("string"==typeof t&&(t=NelioContent.helpers.trim(t),t.length>=2&&"@"!==t.substr(0,1)))return NelioContent.i18n.errors.reference.invalidTwitter;var n=this.get("email");if("string"==typeof n&&(n=NelioContent.helpers.trim(n).toUpperCase(),n.length>0)){var i=/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b/;if(!i.test(n))return NelioContent.i18n.errors.reference.invalidMail}return!1},testIfIsInPostContent:function(e){this.get("url");if(this._lastMatchingRegExp.test(e))return void this.set("isInPostContent",!0);var t=!1;_.each(this._regExps,function(n){if(n.test(e))return t=!0,void(this._lastMatchingRegExp=n)},this),this.set("isInPostContent",t)},autoload:function(){if("pending"===this.get("status")){var t=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_autoload_reference",url:this.get("url")},success:function(e){t.set(e)}})}},_generateRegExps:function(){var e=this.get("url");if(0===e.length)this._regExps=[];else{var t=_.escape(e);this._regExps=[new RegExp('"'+e+'"',"i"),new RegExp('"'+t+'"',"i"),new RegExp("'"+e+"'","i"),new RegExp("'"+t+"'","i")]}},_escapeFields:function(){_.each(["author","url","title"],function(e){this.set(e+"Escaped",_.escape(this.get(e)))},this)}}),NelioContent.collections.References=Backbone.Collection.extend({model:NelioContent.models.Reference,post:new NelioContent.models.Post,initialize:function(){this._onAdd=_.bind(this._onAdd,this),this._onRemove=_.bind(this._onRemove,this),this._onReset=_.bind(this._onReset,this),this.listenTo(this,"add",this._onAdd),this.listenTo(this,"remove",this._onRemove),this.listenTo(this,"reset",this._onReset)},suggestReference:function(t){if("undefined"==typeof this.get(t.id)){var n=NelioContent.users.current();"function"==typeof t.set?t.get("suggestionAdvisorId")===-1&&(t.set("suggestionAdvisorDisplayName",n.get("name")),t.set("suggestionAdvisorId",n.get("id"))):"undefined"!=typeof t.suggestionAdvisorId&&t.suggestionAdvisorId!==-1||(t.suggestionAdvisorDisplayName=n.get("name"),t.suggestionAdvisorId=n.get("id")),t=this.add(t),this.listenTo(t,"nc:discard",this.discardReference);var i=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_suggest_post_reference",post:this.post.get("id"),url:t.get("url")},success:function(e){t.set(e)},error:function(e){var n=NelioContent.i18n.errors.reference.notSuggested+" "+e.responseJSON;NelioContent.helpers.openErrorDialog(n),i.remove(t)}})}},discardReference:function(t){var n=t.get("status");t.set("status","_discarding");var i=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_discard_post_reference",post:this.post.get("id"),reference:t.get("postId")},success:function(e){i.remove(t)},error:function(e){var t=NelioContent.i18n.errors.reference.notDiscarded+" "+e.responseJSON;NelioContent.helpers.openErrorDialog(t),this.set("status",n)}})},includeReferences:function(e){var t=this;if(e=_.reject(e,function(e){return t.get(e)}),e.length){var n=this.add(_.map(e,function(e){return{id:e,url:e,status:"improvable"}}));_.each(n,function(e){t._addPostReference(e)})}},removeIncludedReferences:function(e){if(e.length){var t=this.remove(e),n=this;_.each(t,function(e){n._removePostReference(e)})}},setPost:function(e){this.post=e},_onAdd:function(e){this.listenTo(e,"nc:discard",this.discardReference),e.autoload()},_onRemove:function(e){this.stopListening(e)},_onReset:function(e,t){_.each(t.previousModels,this._onRemove),this.each(this._onAdd)},_addPostReference:function(t){e.ajax({url:ajaxurl,data:{action:"nelio_content_add_post_reference",post:this.post.get("id"),url:t.get("url")},success:function(e){t.set(e),t.autoload()}})},_removePostReference:function(t){e.ajax({url:ajaxurl,data:{action:"nelio_content_delete_post_reference_by_url",post:this.post.get("id"),url:t.get("url")}})}}),NelioContent.models.EditorialComment=NelioContent.models.Model.extend({urlRoot:NelioContent.apiUri+"/comment",defaults:function(){return{comment:"",date:ncNewLocalMoment(),authorId:NelioContent.users.current().get("id"),postId:0,postType:NelioContent.postTypes[0].name}},initialize:function(){this.listenTo(this,"change:date",this._fixDateFormat),this._fixDateFormat()},save:function(){if(this.isNew()){arguments[1]=arguments[1]||{};var t=arguments[1].success,n=this.toJSON();arguments[1].success=function(){var i={action:"nelio_content_new_comment",comment:n.comment,post_id:n.postId,author_id:n.authorId,date:n.date.toISOString()};e.ajax({url:ajaxurl,data:i}),"function"==typeof t&&t.apply(this,arguments)}}NelioContent.models.Model.prototype.save.apply(this,arguments)},_fixDateFormat:function(){var e=this.get("date");"string"==typeof e&&this.set("date",ncNewLocalMoment(e))}}),NelioContent.collections.EditorialComments=NelioContent.collections.Collection.extend({model:NelioContent.models.EditorialComment,post:void 0,initialize:function(){this.listenTo(this,"add",this._onAdd),this.listenTo(this,"remove",this._onRemove),this.listenTo(this,"reset",this._onReset)},setPost:function(e){this.post=e,this.each(function(e){e.set("postId",this.post.get("id")),e.set("postType",this.post.get("type"))},this)},_onAdd:function(e){this.listenTo(e,"destroy",this.remove),e.set("postId",this.post.get("id")),e.set("postType",this.post.get("type"))},_onRemove:function(e){this.stopListening(e)},_onReset:function(e,t){_.each(t.previousModels,this._onRemove,this),this.each(this._onAdd,this)}}),NelioContent.models.EditorialTask=NelioContent.models.Model.extend({urlRoot:NelioContent.apiUri+"/task",defaults:function(){return{task:"",completed:!1,color:"none",calendarKind:"task",postId:0,postType:NelioContent.postTypes[0].name,baseDatetime:"none",dateDue:ncNewLocalMoment(),dateType:"predefined-offset",dateValue:"0",timezone:NelioContent.i18n.timezone,assignerId:NelioContent.users.current().get("id"),assigneeId:NelioContent.users.current().get("id")}},post:new NelioContent.models.Post,initialize:function(){this.listenTo(this,"change:dateDue",this._fixDateDueFormat),this._fixDateDueFormat(),this.listenTo(this,"change:color",this._fixColor),this._fixColor(),this.listenTo(this,"change:completed",this._onCompletionChange)},save:function(){if(this.isNew()){arguments[1]=arguments[1]||{};var e=arguments[1].success,t=this;arguments[1].success=function(){t._sendNotification("new_task"),"function"==typeof e&&e.apply(this,arguments)}}NelioContent.models.Model.prototype.save.apply(this,arguments)},setPost:function(e){this.stopListening(this.post),this.post=e,this.set("postId",this.post.get("id")),this.set("postType",this.post.get("type")),this._setBaseDatetime(),this.listenTo(this.post,"change:dateType",this._setBaseDatetime)},toggleCompletionInAws:function(e){var t=this.get("completed");this.set("completed",!this.get("completed")),this.save(void 0,{success:function(n,i){n.set("completed",i.completed),!t&&n.get("completed")&&n._sendNotification("task_completed"),"function"==typeof e&&e()}})},isSomethingMissing:function(){return NelioContent.helpers.trim(this.get("task"))<=0?NelioContent.i18n.errors.task.noTask:""===NelioContent.helpers.trim(this.get("dateValue"))?NelioContent.i18n.errors.datetime.noDate:"exact"===this.get("dateType")&&!NelioContent.helpers.isDate(this.get("dateValue"))&&NelioContent.i18n.errors.datetime.invalidDate},getDateForSorting:function(){var e="";if(this.post.isPublished()||this.post.isScheduled()){var t=this.get("dateDue");"string"==typeof t&&(t=ncNewLocalMoment(t)),e+=t.toISOString()}else if("exact"===this.get("dateType"))e+=this.get("dateValue");else{var n="Z0000000"+this.get("dateValue");e+=n.substr(n.length-6)}return e},getRelevantDay:function(){return this.get("dateDue").format("YYYY-MM-DD")},reschedule:function(e){if("exact"===this.get("dateType")){if(this.get("dateValue")===e)return void this.trigger("nc:abort:reschedule");this.set("dateValue",e),this.set("dateDue",ncNewLocalMoment(e+"T12:00:00.000"))}else{var t=ncNewLocalMoment(this.get("dateDue").format("YYYY-MM-DD")+"T12:00:00.000"),n=ncNewLocalMoment(e+"T12:00:00.000"),i=n.diff(t,"d");if(0===i)return void this.trigger("nc:abort:reschedule");var o=parseInt(this.get("dateValue"));"negative-days"===this.get("dateType")&&(o=-o);var s=o+i;t.format("HH:mm");s>0?(this.set("dateType","positive-days"),this.set("dateValue",""+s)):s<0?(this.set("dateType","negative-days"),this.set("dateValue",""+Math.abs(s))):(this.set("dateType","predefined-offset"),this.set("dateValue","0")),this.get("dateDue").add(i,"d")}this.set("baseDatetime","reschedule"),this.save(void 0,{success:function(e,t){e.set(t),e._setBaseDatetime(),e.trigger("nc:reschedule")},error:function(e){e.trigger("nc:error")}})},_sendNotification:function(t){var n=this.toJSON(),i={action:"nelio_content_task_notification",mode:t,task:n.task,post_id:n.postId,assignee_id:n.assigneeId,assigner_id:n.assignerId,completed:n.completed,date_due:n.dateDue.toISOString()||void 0};e.ajax({url:ajaxurl,data:i})},_fixDateDueFormat:function(){var e=this.get("dateDue");"string"==typeof e&&this.set("dateDue",ncNewLocalMoment(e))},_fixColor:function(){var e=["none","red","orange","yellow","green","cyan","blue","purple"];_.contains(e,this.get("color"))||this.set("color","none")},_setBaseDatetime:function(){0===this.post.get("id")||this.post.isPublished()?"exact"===this.get("dateType")?this.set("baseDatetime","none"):this.set("baseDatetime","now"):this.post.isScheduled()?"exact"===this.get("dateType")?this.set("baseDatetime","none"):this.set("baseDatetime",this.post.get("date").clone()):this.set("baseDatetime","none")}}),NelioContent.collections.EditorialTasks=NelioContent.collections.Collection.extend({model:NelioContent.models.EditorialTask,post:void 0,initialize:function(){this.listenTo(this,"add",this._onAdd),this.listenTo(this,"remove",this._onRemove),this.listenTo(this,"reset",this._onReset)},setPost:function(e){this.post=e,this.each(function(e){e.set("postId",this.post.get("id")),e.set("postType",this.post.get("type"))},this)},_triggerModelChange:function(e){this.trigger("nc:change:model",this,e)},_onAdd:function(e){this.listenTo(e,"change",this._triggerModelChange),this.listenTo(e,"destroy",this.remove),e.set("postId",this.post.get("id")),e.set("postType",this.post.get("type"))},_onRemove:function(e){this.stopListening(e)},_onReset:function(e,t){_.each(t.previousModels,this._onRemove,this),this.each(this._onAdd,this)}}),NelioContent.collections.Followers=NelioContent.collections.Collection.extend({model:NelioContent.models.User,comparator:function(e,t){return NelioContent.users.current().get("id")===e.id?-1:NelioContent.users.current().get("id")===t.id?1:this.post.get("author")===e.id?-1:this.post.get("author")===t.id?1:e.id-t.id},post:void 0,initialize:function(e,t){this.post=t.post,this.reset(this.post.get("followers"))}}),NelioContent.collections.MonthlyCalendarItems=NelioContent.collections.Collection.extend({_isLoading:!1,_today:void 0,_firstDayInCalendar:void 0,_lastDayInCalendar:void 0,_firstDayOfMonth:void 0,_postAjaxRequest:void 0,_awsItemAjaxRequest:void 0,model:function(e,t){switch(e.calendarKind){case"post":return new NelioContent.models.Post(e,t);case"social":return new NelioContent.models.SocialMessage(e,t);case"task":return new NelioContent.models.EditorialTask(e,t)}},initialize:function(e,t){this._doLoadItemsDebounced=_.debounce(this._doLoadItems,500),this.refresh=_.bind(this.refresh,this),this._today=ncNewLocalMoment(),this._firstDayOfMonth=this._today;var n=this._firstDayOfMonth;"object"==typeof t&&"string"==typeof t.date&&(/^[12][01][0-9][0-9]-[01][0-9]-[0123][0-9]$/.test(t.date)?n=t.date:/^[2][01][0-9][0-9]-[0-1][0-9]$/.test(t.date)&&(n=t.date+"-10")),this.gotoDate(n),this.listenTo(this,"nc:change:date",this._loadItems),this._isLoading=!0,this._doLoadItems()},getFirstDay:function(){return this._firstDayInCalendar.clone()},getLastDay:function(){return this._firstDayInCalendar.clone().add(41,"d")},getToday:function(){return this._today.clone()},getFirstDayOfMonth:function(){return this._firstDayOfMonth.clone()},gotoDate:function(e){switch(typeof e){case"object":this._firstDayOfMonth=ncLocalizeMoment(e.clone());break;case"undefined":this._firstDayOfMonth=ncNewLocalMoment();break;default:this._firstDayOfMonth=ncNewLocalMoment(e)}var t=this._firstDayOfMonth.clone();t.date(1),t.hours(0),t.minutes(0),t.seconds(0),t.milliseconds(0),this._firstDayOfMonth=t.clone();for(var n=this._firstDayOfMonth.clone().startOf("week").format("d");t.format("d")!=n;)t.add(-1,"d");if(this._firstDayInCalendar=t.clone(),t.add(6,"w"),t.add(-1,"ms"),this._lastDayInCalendar=t.clone(),"undefined"!=typeof history&&"function"==typeof history.replaceState){var i=window.location.href;i=i.replace(/\bdate=([12][01][0-9][0-9]-[01][0-9](-[0123][0-9])?)\b/,""),i=i.replace(/\?$/,""),i=i.replace(/\&$/,""),i+=i.indexOf("?")===-1?"?":"&",i+="date="+this._firstDayOfMonth.format("YYYY-MM"),history.replaceState(null,null,i)}this.reset([]),this.trigger("nc:reset:empty"),this.trigger("nc:reset"),this.trigger("nc:change:date")},prevMonth:function(){this._firstDayInCalendar.add(-2,"w"),this.gotoDate(this._firstDayInCalendar)},nextMonth:function(){this._firstDayInCalendar.add(8,"w"),this.gotoDate(this._firstDayInCalendar)},isTodayVisible:function(){return this._today.month()===this._firstDayOfMonth.month()&&this._today.year()===this._firstDayOfMonth.year()},refresh:function(){this._isLoading=!0,this.trigger("nc:change:isLoading",!0),this._doLoadItems()},isLoading:function(){return this._isLoading},toCSV:function(){var t=[];this.each(function(e){var n=e.toJSON();switch(e.get("calendarKind")){case"social":n.date=e.get("schedule").format("YYYY-MM-DD"),n.time=e.get("schedule").format("HH:mm"),n.sort=e.get("schedule").format("YYYY-MM-DD")+"1"+e.get("schedule").format("HH:mm")+"1"+n.textComputed;break;case"task":n.date=e.get("dateDue").format("YYYY-MM-DD"),n.time="",n.sort=e.get("dateDue").format("YYYY-MM-DD")+"0"+n.task;break;default:n.date=e.get("date").format("YYYY-MM-DD"),n.time=e.get("date").format("HH:mm"),n.sort=e.get("date").format("YYYY-MM-DD")+"1"+e.get("date").format("HH:mm")+"0"+n.title}t.push(n)}),t=t.sort(function(e,t){return e.sort<t.sort?-1:e.sort>t.sort?1:0});var n=this.getFirstDayOfMonth(),i=this.getFirstDayOfMonth().add(1,"month");t=_.filter(t,function(e){var t=ncNewLocalMoment(e.date+" 10:00");return n.isBefore(t)&&t.isBefore(i)});var o,s={};o=_.filter(t,function(e){return"post"!==e.calendarKind&&e.postId>0}),o=_.uniq(_.pluck(o,"postId"));var a=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_get_post_permalinks",posts:o},success:function(e){s=e},complete:function(){a.trigger("nc:download:csv",a._genCSV(t,s))}})},_genCSV:function(e,t){var n='"Date","Time","Type","Author/Profile/Assignee","Title/Text/Task","Permalink","Status"\n';return _.each(e,function(e){switch(e.calendarKind){case"social":n+='"'+e.date+'",',n+='"'+e.time+'",',n+='"'+NelioContent.helpers.capitalizeFirstLetter(e.network)+'",',n+='"'+NelioContent.profiles.get(e.profileId).get("username")+'",',n+='"'+e.textComputed.replace(/"/g,'""')+'",',n+='"'+(t[e.postId]||"N/A")+'",',n+='"'+e.status+'"';break;case"task":n+='"'+e.date+'",',n+='"'+e.time+'",',n+='"Editorial Task",',n+='"'+NelioContent.users.get(e.assigneeId).get("name")+'",',n+='"'+e.task.replace(/"/g,'""')+'",',n+='"'+(t[e.postId]||"N/A")+'",',n+='"'+(e.completed?"done":"pending")+'"';break;default:var i=_.findWhere(NelioContent.postTypes,{name:e.type});i="undefined"!=typeof i?i.labels.singular:e.type,n+='"'+e.date+'",',n+='"'+e.time+'",',n+='"WordPress '+i+'",',n+='"'+NelioContent.users.get(e.author).get("name")+'",',n+='"'+e.title.replace(/"/g,'""')+'",',n+='"'+e.permalink+'",',n+='"'+e.status+'"'}n+="\n"}),n.replace(/\n$/,"")},_loadItems:function(){"undefined"!=typeof this._postAjaxRequest&&this._postAjaxRequest.abort(),"undefined"!=typeof this._awsItemAjaxRequest&&this._awsItemAjaxRequest.abort(),this._isLoading=!0,this.trigger("nc:change:isLoading",!0),this._doLoadItemsDebounced()},_doLoadItems:function(){var t=this,n=[];this._postAjaxRequest=e.ajax({url:ajaxurl,data:{action:"nelio_content_get_monthly_posts",start:this.getFirstDay().format("YYYY-MM-DD"),end:this.getLastDay().format("YYYY-MM-DD")},success:function(e){n=_.union(n,e)}}),this._awsItemAjaxRequest=e.ajax({url:NelioContent.apiUri+"/calendar",method:"GET",headers:{Authorization:"Bearer "+NelioContent.apiAuthToken,"Content-Type":"application/json"},data:{from:this.getFirstDay().clone().add(-1,"d").format("YYYY-MM-DD"),to:this.getLastDay().clone().add(1,"d").format("YYYY-MM-DD")},success:function(e){var t=[];_.each(e.social,function(e){e.calendarKind="social",t.push(e)}),_.each(e.tasks,function(e){e.calendarKind="task",t.push(e)}),n=_.union(n,t)},error:function(e){"abort"!==e.statusText&&NelioContent.helpers.openErrorDialog(NelioContent.i18n.errors.api.unableToRetrieveCalendar)}}),t._postAjaxRequest.always(function(){t._awsItemAjaxRequest.always(function(){t._postAjaxRequest=void 0,t._awsItemAjaxRequest=void 0,t.reset(n),t.trigger("nc:reset:items"),t.trigger("nc:reset"),t._isLoading=!1,t.trigger("nc:change:isLoading")})})}}),NelioContent.collections.SocialTimeline=NelioContent.collections.Collection.extend({model:NelioContent.models.SocialMessage,post:void 0,initialize:function(){this.fillTimelineAutomatically=_.bind(this.fillTimelineAutomatically,this),this.listenTo(this,"add",this._onAdd),this.listenTo(this,"remove",this._onRemove),this.listenTo(this,"reset",this._onReset)},getDisabledProfileIds:function(){if(NelioContent.helpers.isSubscribed())return[];var e=ncNewLocalMoment().format("YYYY-MM-DD"),t=this.filter(function(t){return t.getRelevantDay()===e});return t=_.map(t,function(e){return e.toJSON()}),_.uniq(_.pluck(t,"profileId"))},setPost:function(e){this.post=e,this.each(function(e){e.setPost(this.post)},this),this.trigger("nc:set:post")},fillTimelineAutomatically:function(){function t(t){var i=NelioContent.helpers.processHtml(t.content);t=_.extend(t,i),e.ajax({url:NelioContent.apiUri+"/post/"+t.id+"/social/auto",type:"POST",headers:{Authorization:"Bearer "+NelioContent.apiAuthToken,"Content-Type":"application/json"},data:JSON.stringify(t),success:function(e){n.reset(e),n.trigger("nc:auto:ready")},error:function(e){var t=NelioContent.i18n.errors.api.emptyAjaxStatus;NelioContent.helpers.trim(e.responseJSON.errorMessage).length&&(t=NelioContent.i18n.errors.api.generic+" ",t+=NelioContent.helpers.trim(e.responseJSON.errorMessage)),n.trigger("nc:auto:error",t)}})}var n=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_get_post_for_auto_sharing",post:this.post.get("id")},success:function(e){t(e)},error:function(){var e=NelioContent.i18n.errors.generic.unknown;n.trigger("nc:auto:error",e)}})},_onAdd:function(e){this.listenTo(e,"destroy",this.remove),e.setPost(this.post)},_onRemove:function(e){this.stopListening(e)},_onReset:function(e,t){_.each(t.previousModels,this._onRemove,this),this.each(this._onAdd,this)}}),NelioContent.models.SocialProfile=NelioContent.models.Model.extend({_allowsMultiTargets:!1,_isImageRequired:!1,_autoFrequencies:void 0,urlRoot:NelioContent.apiUri+"/profile",defaults:function(){return{calendarId:"",profileId:"",network:"",kind:"",photo:"",creationDate:ncNewLocalMoment(),displayName:"",firstLetter:"",creatorId:0,creatorDisplayName:"",creatorEditLink:"",publicationFrequency:0,reshareFrequency:0,username:"",status:"valid",synching:!1}},_creator:!1,initialize:function(){this.listenTo(this,"change:displayName",this._setFirstLetter),this._setFirstLetter(),this.listenTo(this,"change:displayName",this._escapeNameAndUsername),this.listenTo(this,"change:username",this._escapeNameAndUsername),this._escapeNameAndUsername(),this.listenTo(this,"change:creationDate",this._fixCreationDateFormat),this._fixCreationDateFormat(),this.listenTo(this,"change:network",this._fixAllowsMultiTargets),this._fixAllowsMultiTargets(),this.listenTo(this,"change:network",this._fixImageIsRequired),this._fixImageIsRequired(),this.listenTo(this,"change:creatorId",this._changeCreator),this._changeCreator(),this._autoFrequencies={publication:this.get("publicationFrequency")||0,reshare:this.get("reshareFrequency")||0}},allowsMultiTargets:function(){return this._allowsMultiTargets},requiresImageToShare:function(){return this._isImageRequired},setAutoPublicationFrequency:function(e){if(!this.get("synching")){this.set("synching",!0);var t,n=_.findWhere(NelioContent.networkMetas,{id:this.get("network")});t=n?n.socialAutomations:{reshare:{low:1,mid:1,high:1},publication:{low:1,mid:1,high:1},boostedPublication:{low:1,mid:1,high:1}},this.get("publicationFrequency")&&(this.get("reshareFrequency")?this.set("publicationFrequency",t.boostedPublication[e]):this.set("publicationFrequency",t.publication[e])),this.get("reshareFrequency")&&this.set("reshareFrequency",t.reshare[e]),this._synchronizeFrequencies()}},toggleAutoPublication:function(e){this.get("synching")||(this.get("publicationFrequency")?this.set("publicationFrequency",0):this.set("publicationFrequency",-1),this.setAutoPublicationFrequency(e))},toggleAutoReshare:function(e){this.get("synching")||(this.get("reshareFrequency")?this.set("reshareFrequency",0):this.set("reshareFrequency",-1),this.setAutoPublicationFrequency(e))},guessFrequency:function(){var e,t=_.findWhere(NelioContent.networkMetas,{id:this.get("network")});e=t?t.socialAutomations:{reshare:{low:1,mid:1,high:1},publication:{low:1,mid:1,high:1},boostedPublication:{low:1,mid:1,high:1}};var n="unknown",i="unknown",o=this.get("publicationFrequency"),s=this.get("reshareFrequency");return o&&s?_.each(["low","mid","high"],function(t){e.boostedPublication[t]===o&&(n=t)}):o&&_.each(["low","mid","high"],function(t){e.publication[t]===o&&(n=t)}),s&&_.each(["low","mid","high"],function(t){e.reshare[t]===s&&(i=t)}),"low"===n||"low"===i?"low":"mid"===n||"mid"===i?"mid":"high"===n||"high"===i?"high":"unknown"},_synchronizeFrequencies:function(){var t=this.get("publicationFrequency")||0,n=this.get("reshareFrequency")||0;if(this._autoFrequencies.publication===t&&this._autoFrequencies.reshare===n)return this.set("synching",!1),void this.trigger("nc:synched");this._autoFrequencies.publication=t,this._autoFrequencies.reshare=n;var i=this;e.ajax({url:NelioContent.apiUri+"/profile/"+this.get("id"),method:"PUT",headers:{Authorization:"Bearer "+NelioContent.apiAuthToken,"Content-Type":"application/json"},data:JSON.stringify({publicationFrequency:t,reshareFrequency:n}),complete:function(){i.set("synching",!1),i.trigger("nc:synched")}}),NelioContent.tmp.wasLastDayWithResharesReset||(NelioContent.tmp.wasLastDayWithResharesReset=!0,e.ajax({url:ajaxurl,data:{action:"nelio_content_reset_last_day_with_reshares"}}))},_setFirstLetter:function(){this.set("firstLetter",NelioContent.helpers.extractFirstLetter(this.get("displayName")))},_fixCreationDateFormat:function(){var e=this.get("creationDate");"string"==typeof e&&this.set("creationDate",ncNewLocalMoment(e))},_changeCreator:function(){this._creator&&(this.stopListening(this._creator),this._creator=!1),this._creator=NelioContent.users.getUser(this.get("creatorId"));var e=this._creator;e.valid()?(this.set("creatorDisplayName",e.get("name")),this.set("creatorEditLink",e.get("editLink"))):(this.set("creatorDisplayName",""),this.set("creatorEditLink",""));var t=this;this.listenTo(e,"nc:load",function(){e.valid()?(t.set("creatorDisplayName",e.get("name")),t.set("creatorEditLink",e.get("editLink"))):(t.set("creatorDisplayName",""),t.set("creatorEditLink",""))})},_escapeNameAndUsername:function(){var e=this.get("username");"twitter"===this.get("network")&&"@"!==e[0]&&(e="@"+e,this.set("username",e)),this.set("displayNameEscaped",_.escape(this.get("displayName"))),this.set("usernameEscaped",_.escape(this.get("username")))},_fixAllowsMultiTargets:function(){var e=_.findWhere(NelioContent.networkMetas,{id:this.get("network")});"undefined"!=typeof e&&e.allowsMultiTargets?this._allowsMultiTargets=!0:this._allowsMultiTargets=!1},_fixImageIsRequired:function(){var e=_.findWhere(NelioContent.networkMetas,{id:this.get("network")});"undefined"!=typeof e&&e.isImageRequired?this._isImageRequired=!0:this._isImageRequired=!1}}),NelioContent.collections.ConnectedSocialProfiles=NelioContent.collections.Collection.extend({model:NelioContent.models.SocialProfile,_isReady:!1,isReady:function(){return this._isReady},populate:function(){this.reload()},guessFrequency:function(){var e=this.map(function(e){return e.guessFrequency()});return _.contains(e,"low")?"low":_.contains(e,"mid")?"mid":"high"},reload:function(){this._isReady=!1;var t=this;e.ajax({url:NelioContent.apiUri+"/profiles",method:"GET",headers:{Authorization:"Bearer "+NelioContent.apiAuthToken,"Content-Type":"application/json"},success:function(e){t._updateProfileAvailabilityInWP(e.length>0),t._isReady=!0,t.reset(e);var n=t.guessFrequency();t.each(function(e){e.setAutoPublicationFrequency(n)}),t.trigger("nc:ready")},error:function(e){t._isReady=!0,t.reset([]),t.trigger("nc:error")}})},reloadAfterAddingNewProfile:function(){this.listenToOnce(this,"reset",this._enableAutomationsInNewestProfile),this.reload()},enablePublicationAutomations:function(){function e(){++n,n>=t.length&&t.trigger("nc:reshare-enabled")}var t=this,n=0;this.each(function(n){t.listenToOnce(n,"nc:synched",e),n.set("publicationFrequency",0),n.set("reshareFrequency",0),n.toggleAutoPublication("high")})},_enableAutomationsInNewestProfile:function(){if(this.length){var e=this.toJSON();e=_.sortBy(e,"creationDate");var t=this.get(e[e.length-1].id);t.toggleAutoPublication(this.guessFrequency())}},_updateProfileAvailabilityInWP:function(t){NelioContent.hasSocialProfiles!==t&&e.ajax({
url:ajaxurl,data:{action:"nelio_content_update_profiles_availability",value:t?"yes":"no"}})}}),NelioContent.profiles=new NelioContent.collections.ConnectedSocialProfiles,NelioContent.profiles.populate(),NelioContent.models.SocialTemplate=NelioContent.models.Model.extend({urlRoot:NelioContent.apiUri+"/template",defaults:function(){return{siteId:"",text:"{title} {permalink}",isFallback:!1,type:"publication",targetName:"default",author:0,postType:"nc_any",postCategory:"nc_none",creationDate:ncNewLocalMoment(),creatorId:NelioContent.users.current().get("id"),creatorDisplayName:"",creatorEditLink:""}},_creator:!1,_referenceRegExp:/{ref:author}|{ref:title}|{ref:twitter}|{ref:url}/,initialize:function(){this.listenTo(this,"change:profileId",this._fixProfileInformation),this.listenTo(this,"change:network",this._fixProfileInformation),this._fixProfileInformation(),NelioContent.profiles.isReady()||this.listenToOnce(NelioContent.profiles,"nc:ready",this._fixProfileInformation),this.listenTo(this,"change:creationDate",this._fixCreationDateFormat),this._fixCreationDateFormat(),this.listenTo(this,"change:creatorId",this._changeCreator),this._changeCreator(),this.listenTo(this,"change:text",this._fixType),this._fixType()},isSomethingMissing:function(){return NelioContent.helpers.trim(this.get("text"))<=0&&NelioContent.i18n.errors.socialTemplate.noMessage},toJSON:function(){var e=NelioContent.models.Model.prototype.toJSON.call(this);return"network"===e.network&&(e.network=e.profileId,delete e.profileId),"post"!==e.postType&&(e.postCategory="nc_none"),delete e.profiles,e},_fixProfileInformation:function(){this.stopListening(this,"change:network",this._fixProfileInformation),this.stopListening(this,"change:profileId",this._fixProfileInformation);var e=this.get("profileId"),t=this.get("network");if("string"==typeof t&&t.length)if("string"==typeof e&&e.length)if(_.contains(_.pluck(NelioContent.networkMetas,"id"),e))this.set("network","network");else{var n=NelioContent.profiles.get(e);"undefined"!=typeof n&&this.set("network",n.get("network"))}else this.set("profileId",t),this.set("network","network");else this.set("profileId","twitter"),this.set("network","network");this.listenTo(this,"change:profileId",this._fixProfileInformation),this.listenTo(this,"change:network",this._fixProfileInformation)},_fixCreationDateFormat:function(){var e=this.get("creationDate");"string"==typeof e&&this.set("creationDate",ncNewLocalMoment(e))},_changeCreator:function(){this._creator&&(this.stopListening(this._creator),this._creator=!1),this._creator=NelioContent.users.getUser(this.get("creatorId"));var e=this._creator;e.valid()?(this.set("creatorDisplayName",e.get("name")),this.set("creatorEditLink",e.get("editLink"))):(this.set("creatorDisplayName",""),this.set("creatorEditLink",""));var t=this;this.listenTo(e,"nc:load",function(){e.valid()?(t.set("creatorDisplayName",e.get("name")),t.set("creatorEditLink",e.get("editLink"))):(t.set("creatorDisplayName",""),t.set("creatorEditLink",""))})},_fixType:function(){if("reshare"!==this.get("type")){var e=this.get("text");this._referenceRegExp.test(e)?this.set("type","reference"):this.set("type","publication")}}}),NelioContent.collections.SocialTemplates=NelioContent.collections.Collection.extend({model:NelioContent.models.SocialTemplate,_isReady:!1,isReady:function(){return this._isReady},populate:function(){this.reload()},reload:function(){this._isReady=!1;var t=this;e.ajax({url:NelioContent.apiUri+"/templates",method:"GET",headers:{Authorization:"Bearer "+NelioContent.apiAuthToken},success:function(e){e.push({text:"{title} {permalink}",isFallback:!0,type:"publication"}),e.push({text:"{title} {permalink}",isFallback:!0,type:"reshare"}),t._isReady=!0,t.reset(e),t.trigger("nc:ready")}})}}),NelioContent.templates=new NelioContent.collections.SocialTemplates,NelioContent.templates.populate(),"object"==typeof NelioContent.lastPublishedPost&&(NelioContent.lastPublishedPost=new NelioContent.models.Post(NelioContent.lastPublishedPost))}(jQuery);