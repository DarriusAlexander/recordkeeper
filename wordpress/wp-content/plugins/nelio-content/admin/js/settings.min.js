!function(e){"use strict";function t(){var t=e("#google-analytics-view-container");a.is(":checked")?(t.find("*").prop("disabled",!1),t.closest("tr").find("th, td").removeClass("nc-disabled-setting"),e(".nc-ga-setting-change-profile .nc-change").css("cursor","pointer"),e(".nc-ga-setting-change-profile .nc-change-wrapper").css("color","#666")):(t.find("*").prop("disabled",!0),t.closest("tr").find("th, td").addClass("nc-disabled-setting"),e(".nc-ga-setting-change-profile .nc-change").css("cursor","auto"),e(".nc-ga-setting-change-profile .nc-change-wrapper").css("color","inherit"))}var i=window.location.href,n="social-profiles",o=!1;if(/\btab=[^&]+\b/.test(i)?n=i.match(/\btab=([^&]+)\b/)[1]:i+="&tab=social-profiles",!NelioContentSettings.isYoastSEOAvailable){var s=e("#qa-is-yoast-seo-integrated");s.prop("disabled",!0),s.closest("tr").find("th, td").addClass("nc-disabled-setting")}if(-1!==i.indexOf("automations-walkthrough")){o=!0,i=i.replace(/automations-walkthrough(=[^&]+)?.?/,"").replace(/\?$|&$/,""),window.history.replaceState({},"",i);var l=e(".nav-tab");_.each(l,function(t){var i=e(t),n=i.attr("href");n=n.replace(/automations-walkthrough(=[^&]+)?.?/,"").replace(/\?$|&$/,""),i.attr("href",n)})}var a=e("#use-analytics");a.on("click",t),t(),NelioContent.views.GoogleAnalyticsSettingView=Backbone.View.extend({_mode:void 0,_$input:void 0,_$select:void 0,_changeProfileTemplate:NelioContent.helpers.getTemplate("_ga-setting-change-profile"),_retrieveGACodeTemplate:NelioContent.helpers.getTemplate("_ga-setting-retrieve-code"),events:{"click .nc-action.nc-dismiss-tokens-warning":"_dismissTokensWarning","change .nc-ga-selector":"_onGAViewChange","click .nc-action.nc-change":"_confirmAccountChange","click .nc-action.nc-do-change":"_doAccountChange","click .nc-action.nc-cancel-change":"_cancelAccountChange","click .nc-connect-ga":"_doConnection","change .nc-ga-code":"_onGACodeChange","keydown .nc-ga-code":"_onGACodeChange","paste .nc-ga-code":"_onGACodeChange","keyup .nc-ga-code":"_onGACodeChange","click .nc-ga-code-cancel":"_cancelCodeRetrieval","click .nc-ga-code-accept":"_processGACode","click .button.nc-refresh-analytics":"_refreshAnalytics"},initialize:function(e){this._$input=e.$input,this._$input.data("token-error")?this._mode="token-error":this._$input.val()?this._mode="view-selector":this._mode="connect-button",this.render=_.bind(this.render,this),this.listenTo(this,"nc:render",this.render),this._manageConfirmButton=_.debounce(this._manageConfirmButton,100)},render:function(){switch(this._mode){case"token-error":this._renderTokensExpirationWarning();break;case"view-selector":case"view-selector-awaiting-confirmation":case"view-selector-changing":this._renderViewSelector();break;case"connect-button":this._renderConnectButton();break;case"ga-retrieving-code":case"ga-code-retrieval":this._renderGACodeRetrieval()}return this.trigger("nc:change:analytics"),this},_renderTokensExpirationWarning:function(){this.$el.html("<p>"+NelioContent.i18n.feedback.gaTokensExpired+'</p><a class="button nc-action nc-dismiss-tokens-warning">'+NelioContent.i18n.actions.ok+"</a>")},_renderViewSelector:function(){return"undefined"==typeof this._$select?(this.$el.html('<span class="spinner is-active nc-ga-loading"></span>'),void this._loadViewsFromGoogleAnalytics()):void this.$(".nc-ga-setting-change-profile").html(this._changeProfileTemplate({mode:this._mode}))},_loadViewsFromGoogleAnalytics:function(){var t=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_get_ga_views"},success:function(e){var i=t._prepareViewSelectorData(e);t._makeViewSelector(i)},error:function(e){NelioContent.helpers.openErrorDialog(e.responseJSON),t._makeViewSelector([])}})},_renderConnectButton:function(){var t="<div>";t+='<button class="button nc-connect-ga">'+NelioContent.i18n.actions.connectGoogleAnalytics+"</button> ",t+='<button class="button nc-refresh-analytics">'+NelioContent.i18n.actions.refreshAnalytics+"</button>",t+="</div>";var i=e(t);this.$el.html(i)},_dismissTokensWarning:function(e){e.preventDefault(),this._mode="connect-button",this.trigger("nc:render")},_doConnection:function(e){e.preventDefault(),this._mode="ga-code-retrieval",this.trigger("nc:render")},_renderGACodeRetrieval:function(){this.$el.html(e('<div class="ga-setting-retrieve-code"></div>')),this.$(".ga-setting-retrieve-code").html(this._retrieveGACodeTemplate({})),i="https://accounts.google.com/o/oauth2/v2/auth?client_id=1085875842646-v5k3smokc0j3hnjev0q2bq7r3kbgqlmm.apps.googleusercontent.com&response_type=code&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=https://www.googleapis.com/auth/analytics.readonly";NelioContent.helpers.openPopup(i,640,480)},_onGACodeChange:function(e){13===e.keyCode&&e.preventDefault(),this._manageConfirmButton(e)},_manageConfirmButton:function(t){if("ga-code-retrieval"===this._mode){var i=e(".nc-ga-code"),n=e(".nc-ga-code-accept");i.val()?(n.prop("disabled",!1),"keyup"===t.type&&13===t.keyCode&&this._processGACode(t)):n.prop("disabled",!0)}},_cancelCodeRetrieval:function(e){e.preventDefault(),this._mode="connect-button",this.trigger("nc:render")},_processGACode:function(t){if(t.preventDefault(),"ga-retrieving-code"!==this._mode){this._mode="ga-retrieving-code";var i=e(".nc-ga-code"),n=e(".nc-ga-code-accept"),o=e(".nc-ga-code-cancel");i.prop("disabled",!0),n.prop("disabled",!0),o.prop("disabled",!0),n.html(NelioContent.i18n.feedback.loading);var s=e(".nc-ga-code").val(),l=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_get_ga_token",code:s},success:function(e){l._mode="view-selector",l._loadViewsFromGoogleAnalytics()},error:function(e){NelioContent.helpers.openErrorDialog(e.responseJSON),n.html(NelioContent.i18n.actions.load),i.prop("disabled",!1),n.prop("disabled",!1),o.prop("disabled",!1),l._mode="ga-code-retrieval"}})}},_prepareViewSelectorData:function(e){var t=this._$input.val(),i=[];return e.items.forEach(function(e){e.webProperties&&e.webProperties.forEach(function(e){var t=_.map(e.profiles,function(e){return{id:e.id,text:e.name}});i.push({id:e.id,text:e.name,children:t})})}),_.contains(_.pluck(_.flatten(_.pluck(i,"children")),"id"),t)||this._updateHiddenInput(""),i},_makeViewSelector:function(t){this._$select=e('<select class="nc-ga-selector"></select>'),this.$el.html(this._$select),this.$el.append(e('<div class="nc-ga-setting-change-profile"></div>')),this._$select.ncselect2({data:t,templateResult:this._templateGAViewResult,width:"400px",dropdownCssClass:"nc-ga-selector-dropdown",placeholder:NelioContent.i18n.settings.gaSelectorPlaceholder}),this._$select.val(this._$input.val()),this._$select.trigger("change"),this.trigger("nc:render")},_onGAViewChange:function(){this._updateHiddenInput(this._$select.val())},_confirmAccountChange:function(){this._mode="view-selector-awaiting-confirmation",this.trigger("nc:render")},_cancelAccountChange:function(){this._mode="view-selector",this.trigger("nc:render")},_doAccountChange:function(){this._mode="connect-button",this._$select.ncselect2("destroy"),this._$select=void 0,this._updateHiddenInput(""),this.trigger("nc:render")},_templateGAViewResult:function(t){var i;return i=e(void 0!==t.children?'<span class="nc-ga-view-text">'+t.text+'</span><span class="nc-ga-view-id">('+t.id+")</span>":'<span class="nc-ga-view-text">'+t.text+"</span>")},_refreshAnalytics:function(e){e.preventDefault();var t=new NelioContent.views.AnalyticsRefresherSettingView;t.render().open()},_updateHiddenInput:function(e){this._$input.val(e).trigger("change"),this.$(".nc-refresh-analytics").prop("disabled",e!==NelioContent.analytics.gaViewId)},close:function(){this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.AnalyticsRefresherSettingView=Backbone.View.extend({_buttons:void 0,_closed:!1,_data:void 0,className:"nc-analytics-refresher-dialog",template:NelioContent.helpers.getTemplate("_analytics-refresher-dialog"),events:{"change .nc-period":"_changePeriod"},initialize:function(t){this.render=_.bind(this.render,this),this._requestNextBatch=_.bind(this._requestNextBatch,this),this._processBatch=_.bind(this._processBatch,this),this.listenTo(this,"nc:render",this.render),this.listenTo(this,"nc:click:dialog:cancel",this.close),this.listenTo(this,"nc:click:dialog:refresh-analytics",this._refreshAnalytics);var i=this;this.$el.dialog({title:NelioContent.i18n.titles.refreshAnalytics,modal:!0,autoOpen:!1,closeOnEscape:!1,width:Math.min(500,e(window).width()-20),dialogClass:"nc-dialog",buttons:[NelioContent.helpers.makeDialogButton(this,"cancel",NelioContent.i18n.actions.cancel,!1),NelioContent.helpers.makeDialogButton(this,"refresh-analytics",NelioContent.i18n.actions.refreshAnalytics,!0)],close:function(){i.close()}}),this._data={batch:0,period:"month",processedItems:0,totalItems:0}},render:function(){return this.$el.html(this.template()),this},open:function(){this.$el.dialog("open");var e=this.$el.closest(".ui-dialog");return this._buttons={$refresh:e.find(".nc-refresh-analytics-button"),$cancel:e.find(".nc-cancel-button")},this},_lock:function(){this._buttons.$refresh.prop("disabled",!0),this.$("select").prop("disabled",!0),this.$("input").prop("disabled",!0)},_unlock:function(){this.$("input").prop("disabled",!1),this.$("select").prop("disabled",!1),this._buttons.$refresh.prop("disabled",!1),this._buttons.$refresh.html(NelioContent.i18n.actions.refreshAnalytics)},_changePeriod:function(e){e.preventDefault(),this._data.period=this.$(".nc-period").val()},_refreshAnalytics:function(){this._lock(),this._buttons.$refresh.html(NelioContent.i18n.feedback.refreshingAnalytics),this._data.batch=0,this._data.processedItems=0,this.$(".nc-count .nc-total").html(NelioContent.i18n.feedback.retrievingPosts),this._requestNextBatch()},_requestNextBatch:function(){if(!this._closed){++this._data.batch;var t=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_get_post_ids",page:this._data.batch,period:this._data.period},success:function(e){return 1===t._data.batch&&0===parseInt(e.found)?(t.close(),void NelioContent.helpers.openWarningDialog(NelioContent.i18n.titles.refreshAnalytics,NelioContent.i18n.dialogs.analyticsNoPostsFound)):"object"!=typeof e.items||0===e.items.length?void t._updateLastGlobalUpdate():(1===t._data.batch&&(t._data.totalItems=parseInt(e.found),t._updateProgressBar()),void t._processBatch(e.items))},error:function(){t._unlock()}})}},_processBatch:function(t){for(var i=this,n=[],o=0;o<t.length;++o)n.push(e.ajax({url:ajaxurl,data:{action:"nelio_content_update_analytics",post:t[o]},complete:function(){i._closed||(++i._data.processedItems,i._updateProgressBar())}}));e.when.apply(this,n).always(this._requestNextBatch)},_updateLastGlobalUpdate:function(){this._buttons.$cancel.prop("disabled",!0),this.$(".nc-count .nc-current").empty(),this.$(".nc-count .nc-total").html(NelioContent.i18n.feedback.waitAMoment);var t=this;e.ajax({url:ajaxurl,data:{action:"nelio_content_update_analytics_last_global_update"},complete:function(){t.close(),NelioContent.helpers.openDialog(NelioContent.i18n.titles.refreshAnalytics,"<p>"+NelioContent.i18n.dialogs.analyticsProcessed.replace(/{posts}/,t._data.totalItems)+"</p>")}})},_updateProgressBar:function(){if(!this._closed){var e=Math.round(100*this._data.processedItems/this._data.totalItems);this.$(".nc-progress-bar").css("width",Math.min(100,e)+"%"),this.$(".nc-count .nc-current").html(this._data.processedItems),this.$(".nc-count .nc-total").html("/"+this._data.totalItems)}},close:function(){this.$el.dialog("destroy"),this._closed=!0,this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}});var r=new NelioContent.views.GoogleAnalyticsSettingView({el:e("#google-analytics-view-container"),$input:e("#google-analytics-view-input")});Backbone.listenTo(r,"nc:change:analytics",t),r.render();var c,h;"social-profiles"===n&&(NelioContent.views.ConnectedSocialProfile=Backbone.View.extend({_deletionStatus:"none",className:"nc-connected-profile",template:NelioContent.helpers.getTemplate("_nc-connected-social-profile"),events:{mouseleave:"_cancelProfileDeletion","click .nc-auto-publication":"_toggleAutoPublication","click .nc-auto-reshare":"_toggleAutoReshare","click .nc-delete":"_askForProfileDeletionConfirmation","click .nc-cancel-deletion":"_cancelProfileDeletion","click .nc-do-delete":"_deleteProfile","click .nc-reauthenticate":"_reauthenticateProfile","click .nc-refresh":"_reauthenticateProfile"},initialize:function(){this.render=_.bind(this.render,this),this.listenTo(this,"nc:render",this.render),this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON();return e.deletionStatus=this._deletionStatus,e.addedByCurrentUser=this.model.get("creatorId")===NelioContent.users.current().get("id"),this.el.innerHTML=this.template(e),this.el.className=this.className,"renew"===this.model.get("status")&&(this.el.className+=" nc-authentication-required"),"deleting"===this._deletionStatus&&(this.el.className+=" nc-deleting"),this},_toggleAutoPublication:function(e){e.preventDefault(),this.trigger("nc:toggle:publicationFrequency",this.model)},_toggleAutoReshare:function(e){e.preventDefault(),this.trigger("nc:toggle:reshareFrequency",this.model)},_askForProfileDeletionConfirmation:function(){return this._deletionStatus="awaiting-confirmation",this.trigger("nc:render"),!1},_cancelProfileDeletion:function(){return"awaiting-confirmation"===this._deletionStatus&&(this._deletionStatus="none",this.trigger("nc:render")),!1},_deleteProfile:function(){return this._deletionStatus="deleting",this.trigger("nc:render"),this.model.destroy(),!1},_reauthenticateProfile:function(t){var i=t.target||t.srcElement,n=e(i),o=n.data("href");return NelioContent.helpers.openPopup(o,640,480),!1},close:function(){this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.SocialProfileSettings=Backbone.View.extend({_profileViews:[],_wasAbleToAccessAws:!0,_isAutomationsWalkthroughActive:!1,template:NelioContent.helpers.getTemplate("_nc-social-profile-settings"),events:{"click .nc-network:not( .nc-disabled ) .nc-logo":"_addSocialProfile","click .nc-automations-walkthrough":"startAutomationsWalkthrough","change .nc-auto-sharer-frequency":"_updateProfileAutoPublicationFrequency"},initialize:function(){this.collection=NelioContent.profiles,this.render=_.bind(this.render,this),this.listenTo(this.collection,"nc:ready",this.render),this.listenTo(this.collection,"reset",this._resetSocialProfileViews),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this._addSocialProfileView),this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this._removeProfileView),this.listenTo(this.collection,"remove",this.render);var e=this;this.listenTo(this.collection,"nc:error",function(){e._wasAbleToAccessAws=!1,e.render()}),this.collection.isReady()&&(this.collection.each(_.bind(this._addSocialProfileView,this)),this.collection.trigger("nc:ready"))},render:function(){if(!this._wasAbleToAccessAws)return this.el.innerHTML='<p><span class="nc-dashicons nc-dashicons-warning nc-colorize-error"></span> '+NelioContent.i18n.errors.api.emptyAjaxStatus+"</p>",this;var e={isTwitterEnabled:!0,isFacebookEnabled:!0,isGooglePlusEnabled:!0,isInstagramEnabled:!0,isLinkedInEnabled:!0,isPinterestEnabled:!0,maxNumOfProfiles:NelioContent.misc.maxProfiles>0?NelioContent.misc.maxProfiles:NelioContent.networkMetas.length,isLoadingSocialProfiles:!NelioContent.profiles.isReady(),numOfConnectedProfiles:this.collection.length};if(NelioContent.misc.maxProfilesPerNetwork>0){var t=NelioContent.misc.maxProfilesPerNetwork;NelioContent.profiles.where({network:"twitter"}).length>=t&&(e.isTwitterEnabled=!1),NelioContent.profiles.where({network:"facebook"}).length>=t&&(e.isFacebookEnabled=!1),NelioContent.profiles.where({network:"googleplus"}).length>=t&&(e.isGooglePlusEnabled=!1),NelioContent.profiles.where({network:"instagram"}).length>=t&&(e.isInstagramEnabled=!1),NelioContent.profiles.where({network:"linkedin"}).length>=t&&(e.isLinkedInEnabled=!1),NelioContent.profiles.where({network:"pinterest"}).length>=t&&(e.isPinterestEnabled=!1)}NelioContent.misc.maxProfiles>0&&NelioContent.profiles.length>=NelioContent.misc.maxProfiles&&(e.isTwitterEnabled=!1,e.isFacebookEnabled=!1,e.isGooglePlusEnabled=!1,e.isInstagramEnabled=!1,e.isLinkedInEnabled=!1,e.isPinterestEnabled=!1),this.el.innerHTML=this.template(e);var i=this.collection.guessFrequency();this.$(".nc-auto-sharer-frequency").val(i),this._updateMessageEstimate(),this._rendered=0!==this.collection.length;var n=this.$(".nc-connected-profiles");return n.children().detach(),_.each(this._profileViews,function(e){n.append(e.render().el)},this),this.trigger("nc:profiles:rendered"),this},startAutomationsWalkthrough:function(t){if(!this._isAutomationsWalkthroughActive){this._isAutomationsWalkthroughActive=!0,t&&t.preventDefault();var i={target:".nc-auto-publication:eq(0)",title:NelioContent.i18n.pointers.automations.publication,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-publication-pointer").innerHTML),position:{edge:"right",align:"middle"}},n={target:".nc-auto-reshare:eq(0)",title:NelioContent.i18n.pointers.automations.reshare,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-reshare-pointer").innerHTML),position:{edge:"right",align:"middle"}},o={target:".nc-auto-sharer-frequency:eq(0)",title:NelioContent.i18n.pointers.automations.frequency,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-frequency-pointer").innerHTML),position:{edge:"right",align:"middle"}},s={target:".nc-message-estimate:eq(0)",title:NelioContent.i18n.pointers.automations.messageCounter,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-counter-pointer").innerHTML),position:{edge:"bottom",align:"middle"}},l={target:"#social-templates",title:NelioContent.i18n.pointers.automations.templates,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-template-pointer").innerHTML),position:{edge:"top",align:"left"}},a=this;NelioContent.helpers.startPointerTour([i,n,l,o,s],function(){a._isAutomationsWalkthroughActive=!1,e("html, body").animate({scrollTop:0},500)})}},_addSocialProfile:function(t){t.preventDefault();var i,n,o=t.target||t.srcElement,s=e(o),l=s.closest(".nc-network").data("network");switch(l){case"facebook-personal":i=NelioContent.helpers.getTemplate("_nc-connect-facebook-profile-dialog"),n=NelioContent.helpers.openDialog("Facebook","<div>"+i()+"</div>");break;case"linkedin-personal":i=NelioContent.helpers.getTemplate("_nc-connect-linkedin-profile-dialog"),n=NelioContent.helpers.openDialog("LinkedIn","<div>"+i()+"</div>");break;case"googleplus":i=NelioContent.helpers.getTemplate("_nc-connect-googleplus-profile-dialog"),n=NelioContent.helpers.openDialog("Google+","<div>"+i()+"</div>");break;default:var a=s.closest(".nc-network").data("href");NelioContent.helpers.openPopup(a,640,480)}n&&n.find(".nc-logo").on("click",function(){n.dialog("close");var t=e(this).data("href");NelioContent.helpers.openPopup(t,640,480)})},_toggleAutoPublication:function(e){e.toggleAutoPublication(this.$(".nc-auto-sharer-frequency").val()),this._updateMessageEstimate()},_toggleAutoReshare:function(e){e.toggleAutoReshare(this.$(".nc-auto-sharer-frequency").val()),this._updateMessageEstimate()},_updateProfileAutoPublicationFrequency:function(t){var i=t.target||t.srcElement,n=e(i),o=n.val();this.collection.each(function(e){e.setAutoPublicationFrequency(o)}),this.$(".nc-message-estimate").text(n.val()),this._updateMessageEstimate()},_updateMessageEstimate:function(){var e=this.collection.reduce(function(e,t){return e+t.get("publicationFrequency")},0);e=Math.min(e,30),e=Math.min(e,NelioContent.i18n.settings.publicationEstimateMessages.length);var t=this.collection.reduce(function(e,t){return e+t.get("reshareFrequency")},0);t=Math.min(t,30),t=Math.min(t,NelioContent.i18n.settings.reshareEstimateMessages.length);var i=NelioContent.i18n.settings.reshareEstimateMessages[t]+" ";i+=NelioContent.i18n.settings.publicationEstimateMessages[e],i=NelioContent.helpers.trim(i),i.length||(i=NelioContent.i18n.settings.emptyEstimateMessages),this.$(".nc-message-estimate").html(i),e+t?this.$(".nc-auto-sharer-frequency").prop("disabled",this.collection.where({synching:!0}).length):this.$(".nc-auto-sharer-frequency").prop("disabled",!0)},_addSocialProfileView:function(e){var t=new NelioContent.views.ConnectedSocialProfile({model:e});this.listenTo(e,"change:synching",this._updateMessageEstimate),this.listenTo(t,"nc:toggle:publicationFrequency",this._toggleAutoPublication),this.listenTo(t,"nc:toggle:reshareFrequency",this._toggleAutoReshare),this._profileViews.push(t)},_removeProfileView:function(e){var t=_.filter(this._profileViews,function(t){return t.model===e},this);if(t.length>0){var i=t[0];this._profileViews=_.without(this._profileViews,i),this.stopListening(i),i.close()}this.stopListening(e)},_resetSocialProfileViews:function(){_.each(this._profileViews,function(e){e.close()},this),this._profileViews=[],this.collection.each(_.bind(this._addSocialProfileView,this)),this._profileViews.sort(function(e,t){var i=e.model.get("creationDate"),n=t.model.get("creationDate");return n.isBefore(i)?-1:n.isAfter(i)?1:0})},close:function(){_.each(this._profileViews,function(e){e.close()},this),this._profileViews=[],this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),c=new NelioContent.views.SocialProfileSettings,o&&Backbone.listenToOnce(c,"nc:profiles:rendered",_.debounce(c.startAutomationsWalkthrough,750)),h=e("#social-profile-settings-container"),h.html(c.render().el)),"social-templates"===n&&(NelioContent.views.SocialTemplate=Backbone.View.extend({_deletionStatus:"none",_author:void 0,className:"nc-social-template",template:NelioContent.helpers.getTemplate("_nc-social-template"),events:{mouseleave:"_cancelMessageDeletion","click .nc-edit":"_editTemplate","click .nc-actions .nc-delete":"_askForMessageDeletionConfirmation","click .nc-actions .nc-cancel-deletion":"_cancelMessageDeletion","click .nc-actions .nc-do-delete":"_deleteMessage"},initialize:function(){this.render=_.bind(this.render,this),this.listenTo(this.model,"change:author",this._updateAuthorInfo),this._updateAuthorInfo(),this.listenTo(this.model,"change",this.render),this.listenTo(this,"nc:render",this.render),NelioContent.profiles.isReady()||this.listenToOnce(NelioContent.profiles,"nc:ready",this.render)},render:function(){var e=this.model.toJSON();e.deletionStatus=this._deletionStatus,e.addedByCurrentUser=this.model.get("creatorId")===NelioContent.users.current().get("id"),e.textFormatted=_.escape(e.text),e.textFormatted=e.textFormatted.replace(/{(title|excerpt|permalink|tags)}/g,'<span class="nc-tag">{$1}</span>'),"reference"===this.model.get("type")&&(e.textFormatted=e.textFormatted.replace(/{ref:(author|title|twitter|url)}/g,'<span class="nc-tag">{ref:$1}</span>'));var t=this.model.get("postType"),i=this.model.get("postCategory"),n=this.model.get("author"),o=!1;if(e.authorLoading=!1,n&&(this._author.isLoading()?(e.authorLoading=!0,n=0):this._author.get("existsInWordPress")&&(o=_.escape(this._author.get("name")))),e.disabled=!1,"nc_any"===t||_.contains(_.pluck(NelioContent.postTypes,"name"),t)?"post"!==t||"nc_any"===i||_.contains(_.pluck(NelioContent.categories,"name"),i)?n&&!o?(e.application=NelioContent.i18n.templates.disabled,e.disabled=NelioContent.i18n.templates.authorNotFound):"nc_any"!==t||n?"nc_any"===t&&n?e.application=NelioContent.i18n.templates.allContentByAuthor.replace("{author}",o):"post"!==t||"nc_any"===i||n?"post"===t&&"nc_any"!==i&&n?e.application=NelioContent.i18n.templates.postByAuthorInCategory.replace("{category}",_.find(NelioContent.categories,{name:i}).label).replace("{author}",o):"post"!==t&&n?e.application=NelioContent.i18n.templates.contentByAuthor.replace("{type}",_.find(NelioContent.postTypes,{name:t}).labels.plural).replace("{author}",o):e.application=_.find(NelioContent.postTypes,{name:t}).labels.plural:e.application=NelioContent.i18n.templates.postInCategory.replace("{category}",_.find(NelioContent.categories,{name:i}).label):e.application=NelioContent.i18n.templates.allContent:(e.application=NelioContent.i18n.templates.disabled,e.disabled=NelioContent.i18n.templates.postCategoryNotFound):(e.application=NelioContent.i18n.templates.disabled,e.disabled=NelioContent.i18n.templates.postTypeNotFound),"network"===this.model.get("network")){var s=_.findWhere(NelioContent.networkMetas,{id:this.model.get("profileId")});"undefined"==typeof s?(e.profileNameEscaped="",e.profileNetwork="",e.isProfileNetwork=!0):(e.profileNameEscaped=_.escape(s.name),e.profileNetwork=_.escape(s.id),e.isProfileNetwork=!0)}else{var l=NelioContent.profiles.get(this.model.get("profileId"));l?(e.profileNameEscaped=_.escape(l.get("displayName")),e.profileFirstLetter=l.get("firstLetter"),e.profilePhoto=l.get("photo"),e.profileNetwork=l.get("network"),e.isProfileNetwork=!1):(e.profileNameEscaped=NelioContent.i18n.errors.generic.unknownUserName,e.profileFirstLetter="none",e.profilePhoto=!1,e.profileNetwork="unknown",e.isProfileNetwork=!1,e.disabled=!0)}return this.el.innerHTML=this.template(e),e.disabled?this.$el.addClass("nc-disabled"):this.$el.removeClass("nc-disabled"),e.authorLoading||"deleting"===this._deletionStatus?this.$el.addClass("nc-locked"):this.$el.removeClass("nc-locked"),this},getStringForSorting:function(){var e;return"network"===this.model.get("network")?(e=this.model.get("isFallback")?"aa":"ab",e+=_.indexOf(_.pluck(NelioContent.networkMetas,"id"),this.model.get("profileId"))):(e="bb",e+=_.indexOf(_.pluck(NelioContent.networkMetas,"id"),this.model.get("network"))),e+=this.model.get("profileId")+this.model.get("text")+"-"+this.model.get("creationDate").format(),e.toLowerCase()},_editTemplate:function(e){e.preventDefault();var t=this,i=new NelioContent.models.SocialTemplate(this.model.toJSON()),n=new NelioContent.views.SocialTemplateEditor({model:i});this.listenToOnce(n,"nc:save:template",function(e){t.model.clearToDefaults().set(e)}),this.listenToOnce(n,"nc:delete:template",function(){t.model.trigger("destroy",t.model)}),n.render()},_askForProfileDeletionConfirmation:function(){return this._deletionStatus="awaiting-confirmation",this.trigger("nc:render"),!1},_cancelProfileDeletion:function(){return"awaiting-confirmation"===this._deletionStatus&&(this._deletionStatus="none",this.trigger("nc:render")),!1},_askForMessageDeletionConfirmation:function(e){e.preventDefault(),this._deletionStatus="awaiting-confirmation",this.trigger("nc:render")},_cancelMessageDeletion:function(e){e.preventDefault(),"awaiting-confirmation"===this._deletionStatus&&(this._deletionStatus="none",this.trigger("nc:render"))},_deleteMessage:function(e){e.preventDefault(),this._deletionStatus="deleting",this.trigger("nc:render"),this.model.destroy({wait:!0})},_updateAuthorInfo:function(){this._author&&(this.stopListening(this._author),this._author=void 0);var e=this.model.get("author");e&&(this._author=NelioContent.users.getUser(e),this._author.isLoading()&&(this.listenToOnce(this._author,"nc:load",this.render),this.listenToOnce(this._author,"nc:load:error",this.render)))},close:function(){this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.SocialTemplateSettings=Backbone.View.extend({_templateViews:[],template:NelioContent.helpers.getTemplate("_nc-social-template-settings"),events:{"click .nc-add-template":"_createTemplate"},initialize:function(){this.render=_.bind(this.render,this),this._addTemplateView=_.bind(this._addTemplateView,this),this._removeTemplateView=_.bind(this._removeTemplateView,this),this._resetTemplateViews=_.bind(this._resetTemplateViews,this),this._sortTemplateViews=_.bind(this._sortTemplateViews,this),this._sortTemplateViewsDebounced=_.debounce(this._sortTemplateViews,200),this._sortTemplateViewsDebounced=_.bind(this._sortTemplateViewsDebounced,this),"undefined"==typeof this.collection&&(this.collection=new NelioContent.collections.Templates),this._resetTemplateViews(),this.listenTo(this.collection,"reset",this._resetTemplateViews),this.listenTo(this.collection,"add",this._addTemplateView),this.listenTo(this.collection,"remove",this._removeTemplateView),this.listenTo(this,"nc:render",this.render),this.listenTo(this,"nc:sort",this.render)},render:function(){this.el.innerHTML=this.template();var e={publication:{$el:this.$(".nc-publication .nc-social-templates"),hasItems:!1},reshare:{$el:this.$(".nc-reshare .nc-social-templates"),hasItems:!1}};return _.each(this._templateViews,function(t){switch(t.model.get("type")){case"reshare":e.reshare.$el.append(t.render().el),e.reshare.hasItems=!0;break;default:e.publication.$el.append(t.render().el),e.publication.hasItems=!0}},this),_.map(e,function(e){e.hasItems?(e.$el.show(),e.$el.parent().find(".nc-empty").hide()):(e.$el.hide(),e.$el.parent().find(".nc-empty").show())}),this},_createTemplate:function(e){e.preventDefault();var t=e.target||e.srcElement,i="publication";-1!==t.className.indexOf("add-reshare-template")&&(i="reshare");var n=new NelioContent.views.SocialTemplateEditor({model:new NelioContent.models.SocialTemplate({type:i})}),o=this;this.listenToOnce(n,"nc:save:template",function(e){o.collection.add(e)}),n.render()},_addTemplateView:function(e){var t=new NelioContent.views.SocialTemplate({model:e});this._templateViews.push(t),this._sortTemplateViewsDebounced()},_removeTemplateView:function(e){var t=_.filter(this._templateViews,function(t){return t.model.get("id")===e.get("id")},this);if(t.length>0){var i=t[0];this._templateViews=_.without(this._templateViews,i),this.stopListening(i),i.close()}this._templateViews.length||this.trigger("nc:render")},_resetTemplateViews:function(){_.each(this._templateViews,function(e){e.close()},this),this._templateViews=[],this.collection.each(this._addTemplateView)},_sortTemplateViews:function(){this._templateViews.sort(function(e,t){var i=e.getStringForSorting(),n=t.getStringForSorting();return i<n?-1:i>n?1:0}),this.trigger("nc:sort")},close:function(){_.each(this._templateViews,function(e){e.close()},this),this._templateViews=[],this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.UserSelector=Backbone.View.extend({_userOptionTemplate:NelioContent.helpers.getTemplate("_nc-user-selector-option"),_selectedUserTemplate:NelioContent.helpers.getTemplate("_nc-user-selector-selected-option"),_rendered:!1,_defaultValue:void 0,_single:!1,_$select:void 0,_dropdownCssClass:"nc-ncselect2-above-jquery-dialog",_width:"100%",events:{"change .nc-user-selector":"_onUserChange"},initialize:function(e){"undefined"==typeof e&&(e={}),"undefined"!=typeof e.defaultValue&&(this._defaultValue=e.defaultValue),"boolean"==typeof e.single&&(this._single=e.single),"object"==typeof e.$select?this._$select=e.$select:this._$select=jQuery('<select class="nc-user-selector"></select>'),"string"==typeof e.dropdownCssClass&&(this._dropdownCssClass=e.dropdownCssClass),"string"==typeof e.width&&(this._width=e.width),this.render=_.bind(this.render,this),this._getAjaxData=_.bind(this._getAjaxData,this),this._processResults=_.bind(this._processResults,this),this._templateResult=_.bind(this._templateResult,this),this._templateSelection=_.bind(this._templateSelection,this)},render:function(){if(this._rendered)return this;this._rendered=!0;var e=[];if("number"==typeof this._defaultValue){var t=NelioContent.users.getUser(this._defaultValue);if(t.isLoading())return this.listenToOnce(t,"nc:load",this.render),this.listenToOnce(t,"nc:load:error",this.render),this._rendered=!1,this;e=[t.toJSON()]}var i=this;return this.$el.html(this._$select),this._$select.ncselect2({data:e,dropdownCssClass:this._dropdownCssClass,
width:this._width,placeholder:NelioContent.i18n.actions.selectAUser,templateResult:i._templateResult,templateSelection:i._templateSelection,ajax:{url:ajaxurl,cache:!1,dataType:"json",delay:250,data:i._getAjaxData,processResults:i._processResults}}),this.setValue(this._defaultValue),this._single&&this._$select.prop("disabled",!0),this},setValue:function(e){if(!this._rendered)return void(this._defaultValue=e);if("number"==typeof e){var t=_.bind(function(){this.undelegateEvents(),this._$select.empty().html('<option value="'+e+'"></option>').trigger("change"),this.delegateEvents()},this),i=NelioContent.users.getUser(e);i.isLoading()?this.listenToOnce(i,"nc:load",t):t()}},lock:function(){this._$select.prop("disabled",!0)},unlock:function(){this._$select.prop("disabled",!1)},clearSelection:function(){this._$select.val(void 0),this._$select.trigger("change")},_getAjaxData:function(e){var t={action:"nelio_content_get_authors",term:e.term,page:e.page};return t},_processResults:function(e,t){t.page=t.page||1;for(var i=0;i<e.items.length;++i)NelioContent.users.add(e.items[i]),e.items[i]=NelioContent.users.get(e.items[i].id).toJSON();return{results:e.items,pagination:{more:e.more}}},_templateResult:function(t){return"undefined"==typeof t.name?t.text:e(this._userOptionTemplate(t))},_templateSelection:function(t){return isNaN(parseInt(t.id))?t.text:(t=NelioContent.users.getUser(t.id).toJSON(),e(this._selectedUserTemplate(t)))},_onUserChange:function(t){var i=t.target||t.srcElement,n=e(i),o=NelioContent.helpers.trim(n.val());o=isNaN(parseInt(o))?o:parseInt(o),this.trigger("nc:change",o)},close:function(){this._rendered&&this._$select.ncselect2("destroy"),this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.UserFilter=NelioContent.views.UserSelector.extend({_actions:!1,_labels:!1,initialize:function(e){"undefined"==typeof e.defaultValue&&(e.defaultValue="all"),NelioContent.views.UserSelector.prototype.initialize.call(this,e),this._actions=jQuery.extend({},{all:!0,none:!1},e.actions),this._labels=jQuery.extend({},{group:!1,all:!1,none:!1,single:!1},e.labels),this._getAjaxData=_.bind(this._getAjaxData,this),this._processResults=_.bind(this._processResults,this),this._templateResult=_.bind(this._templateResult,this),this._templateSelection=_.bind(this._templateSelection,this)},render:function(){if(this._rendered)return this;if("number"==typeof this._defaultValue&&0<this._defaultValue){var e=NelioContent.users.getUser(this._defaultValue);e.isLoading()||e.get("existsInWordPress")||(this._defaultValue="all")}return NelioContent.views.UserSelector.prototype.render.call(this),"all"===this._defaultValue?(this._$select.val("all"),this._$select.empty().append('<option value="all">'+_.escape(this._labels.all)+"</option>").trigger("change")):"none"===this._defaultValue&&(this._$select.val("none"),this._$select.empty().append('<option value="none">'+_.escape(this._labels.none)+"</option>").trigger("change")),this},_getAjaxData:function(e){var t={action:"nelio_content_get_authors",term:e.term,page:e.page};return t},_processResults:function(e,t){var i=NelioContent.views.UserSelector.prototype._processResults.call(this,e,t);return this._labels.group&&1===t.page&&i.results.length&&i.results.unshift({text:this._labels.group,children:[]}),t.term=t.term||"",1!==t.page||t.term.length||(this._actions.none&&i.results.unshift({id:"none"}),this._actions.all&&i.results.unshift({id:"all"})),i},_templateResult:function(e){return"all"===e.id?this._actions.all:"none"===e.id?this._actions.none:NelioContent.views.UserSelector.prototype._templateResult.call(this,e)},_templateSelection:function(t){if("all"===t.id)return this._labels.all;if("none"===t.id){var i='<span class="nc-dashicons nc-dashicons-hidden"></span> ';return e("<span>"+i+this._labels.none+"</span>")}return this._labels.single?"string"==typeof t.name?this._labels.single.replace("%s",t.name):t.text:NelioContent.views.UserSelector.prototype._templateSelection.call(this,t)}}),NelioContent.views.SingleProfileSelector=Backbone.View.extend({_profileTemplate:{"default":NelioContent.helpers.getTemplate("_nc-single-profile-selector-profile"),selected:NelioContent.helpers.getTemplate("_nc-single-profile-selector-selected-profile")},_targetTemplate:NelioContent.helpers.getTemplate("_nc-single-profile-selector-target"),_previousTargetName:"",_targetDataLoader:void 0,_rendered:!1,events:{"change select.nc-profile":"_changeProfile","change select.nc-target":"_changeTarget"},initialize:function(){this.render=_.bind(this.render,this),this.listenTo(this.model,"change:profileId",this._changeSelectedProfile),this.listenTo(this.model,"change:profileId",this._fixTargetSelectorVisibility)},render:function(){if(this._rendered)return this;this._rendered=!0;var t=jQuery('<div class="nc-profile-container"></div>'),i=jQuery('<select class="nc-profile" name="profile"></select>');t.html(i),this.$el.html(t);var n=this;i.ncselect2({dropdownCssClass:"nc-ncselect2-above-jquery-dialog",data:NelioContent.profiles.toJSON(),width:"100%",matcher:function(e,t){if("object"!=typeof e||"string"!=typeof e.term)return t;e=e.term;var i=t.displayName+" "+t.username;return i.toLowerCase().indexOf(e.toLowerCase())!==-1?(t=_(t).clone(),t.displayNameEscaped=NelioContent.helpers.strongify(_.escape(t.displayName),e),t.usernameEscaped=NelioContent.helpers.strongify(_.escape(t.username),e),t):null},templateResult:function(t){return"undefined"==typeof t.displayName?t.text:e(n._profileTemplate["default"](t))},templateSelection:function(t){return e(n._profileTemplate.selected(t))}}),i.val(this.model.get("profileId")).trigger("change");var o=jQuery('<div class="nc-target-container"></div>'),s=jQuery('<select class="nc-target" name="target"></select>');return o.html(s),s.hide(),this.$el.append(o),this._fixTargetSelectorVisibility(),this},lock:function(){this._isLocked=!0,this.$("select.nc-profile").prop("disabled",!0),this.$("select.nc-target").prop("disabled",!0)},_changeProfile:function(){this.stopListening(this.model,"change:profileId",this._changeSelectedProfile);var e=NelioContent.profiles.get(NelioContent.helpers.trim(this.$("select.nc-profile").val()));"undefined"!=typeof e&&this.model.set("profileId",e.get("id")),this.listenTo(this.model,"change:profileId",this._changeSelectedProfile),this._maybeFixNewMessageInfo()},_changeTarget:function(){var e=this.$("select.nc-target"),t=e.val(),i=e.ncselect2("data"),n=_.findWhere(i,{id:t});"undefined"!=typeof n?(this.model.set("targetName",n.name),this.model.set("targetDisplayName",n.displayName)):(this.model.set("targetName","default"),this.model.set("targetDisplayName","")),this._maybeFixNewMessageInfo()},_changeSelectedProfile:function(){this.stopListening(this.model,"change:profileId",this._changeSelectedProfile),this.$("select").val(this.model.get("profileId")).trigger("change"),this.listenTo(this.model,"change:profileId",this._changeSelectedProfile)},_fixTargetSelectorVisibility:function(){if(this._rendered){var t=this.$(".nc-target");t.ncselect2(),t.ncselect2("destroy"),"undefined"!=typeof this._targetDataLoader&&("function"==typeof this._targetDataLoader.abort&&this._targetDataLoader.abort(),this._targetDataLoader=void 0);var i=NelioContent.profiles.get(this.model.get("profileId"));if(i.allowsMultiTargets()){var n=_.findWhere(NelioContent.networkMetas,{id:this.model.get("network")}),o=this;t.val(""),t.ncselect2({placeholder:n.multiTargetLabels.loading,width:"100%"}),this._targetDataLoader=e.ajax({url:NelioContent.apiUri+"/profile/"+i.get("id")+"/targets",method:"GET",headers:{Authorization:"Bearer "+NelioContent.apiAuthToken,"Content-Type":"application/json"},success:function(e){o._buildTargetSelector(e),o._targetDataLoader=void 0},error:function(){o._targetDataLoader=void 0}}),this._previousTargetName=this.model.get("targetName"),this.model.set("targetName",""),this.model.set("targetDisplayName","")}else this.model.set("targetName","default"),this.model.set("targetDisplayName","")}},_buildTargetSelector:function(t){var i=this.$(".nc-target"),n=this;if(i.ncselect2({dropdownCssClass:"nc-ncselect2-above-jquery-dialog",width:"100%",data:t,matcher:function(e,t){return"object"!=typeof e||"string"!=typeof e.term?t:(e=e.term,t.displayName.toLowerCase().indexOf(e.toLowerCase())!==-1?(t=_(t).clone(),t.displayNameEscaped=NelioContent.helpers.strongify(t.displayName,e),t):null)},templateResult:function(t){return"undefined"==typeof t.displayName?t.text:("undefined"==typeof t.displayNameEscaped&&(t.displayNameEscaped=_.escape(t.displayName)),e(n._targetTemplate(t)))},templateSelection:function(t){return"undefined"!=typeof t.displayName&&"undefined"==typeof t.displayNamedEscaped&&(t.displayNameEscaped=_.escape(t.displayName)),e(n._targetTemplate(t))}}),!(t.length<=0)){var o=t[0],s=_.findWhere(t,{name:this._previousTargetName});"undefined"!=typeof s&&(o=s),i.val(o.id).trigger("change"),this._previousTargetName=""}},_maybeFixNewMessageInfo:function(){this.model.isNew()&&this.model.set("profiles",[{id:this.model.get("profileId"),targetName:this.model.get("targetName"),targetDisplayName:this.model.get("targetDisplayName")}])},close:function(){this._rendered&&(this.$("select.nc-profile").ncselect2("destroy"),this.$("select.nc-target").ncselect2(),this.$("select.nc-target").ncselect2("destroy")),this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.SocialTemplateEditor=Backbone.View.extend({_rendered:!1,_views:{profileSelector:void 0,author:void 0},_$window:void 0,_$saveButton:void 0,_closeAndDestroy:!0,_originalProfileCollection:void 0,className:"nc-social-template-editor",template:NelioContent.helpers.getTemplate("_nc-social-template-editor"),events:{"change .nc-post-filter select":"_changePostType","change textarea":"_changeText","keyup  textarea":"_changeText"},initialize:function(){this._$window=e(window),this.render=_.bind(this.render,this),this._onDialogSave=_.bind(this._onDialogSave,this),this._onDialogCancel=_.bind(this._onDialogCancel,this),this._onDialogDelete=_.bind(this._onDialogDelete,this),this._originalProfileCollection=NelioContent.profiles,NelioContent.profiles=new NelioContent.collections.ConnectedSocialProfiles,_.each(NelioContent.networkMetas,function(e){e.allowsMultiTargets||NelioContent.profiles.add({id:e.id,displayName:e.name,network:e.id,kind:"network"})}),NelioContent.profiles.add(this._originalProfileCollection.toJSON()),this._views.profileSelector=new NelioContent.views.SingleProfileSelector({model:this.model});var t=this.model.get("author");t||(t="all"),this._views.author=new NelioContent.views.UserFilter({defaultValue:t,actions:{all:NelioContent.i18n.templates.anyAuthorAction},labels:{all:NelioContent.i18n.templates.anyAuthorLabel}}),this.listenTo(this._views.author,"nc:change",this._onAuthorChange),this._convertToDialog(),this.listenTo(this.model,"change",this._maybeEnableSaveButton)},render:function(){if(this._rendered)return this;this._rendered=!0;var e=this.model.toJSON();this._views.author.$el.detach(),this.el.innerHTML=this.template(e),this.$el.find(".nc-author .nc-container").html(this._views.author.render().el),NelioContent.profiles.length&&this.$(".nc-profile-selector").html(this._views.profileSelector.render().$el),this._maybeEnableSaveButton();var t=this.$(".nc-post-filter select");return t.val(this.model.get("postType")),t.val()||t.val(this.model.get("postType")+":"+this.model.get("postCategory")),t.val()||(t.val("nc_any"),this.model.set("postType","nc_any"),this.model.set("postCategory","nc_none")),this},_changeText:function(t){if(!this._isLocked){var i=t.target||t.srcElement,n=e(i);this.stopListening(this.model,"change",this.render),this.model.set("text",NelioContent.helpers.trim(n.val())),this.listenTo(this.model,"change",this.render)}},_changePostType:function(t){if(!this._isLocked){var i=t.target||t.srcElement,n=e(i),o=n.val(),s="nc_none";"post"===o?s="nc_any":/^post:/.test(o)&&(s=o.replace(/^post:/,""),o="post"),this.stopListening(this.model,"change",this.render),this.model.set("postType",o),this.model.set("postCategory",s),this.listenTo(this.model,"change",this.render)}},_onAuthorChange:function(e){"all"===e&&(e=0),this.model.set("author",parseInt(e))},_lock:function(){this.$el.addClass("nc-locked"),this._views.profileSelector.lock()},_convertToDialog:function(){var e=[];e.push(NelioContent.helpers.makeDialogCancelButton(this,NelioContent.i18n.actions.cancel)),e.push(NelioContent.helpers.makeDialogSaveButton(this,NelioContent.i18n.actions.save)),this.model.isNew()||e.push(NelioContent.helpers.makeDialogDeleteButton(this,NelioContent.i18n.actions.delLabel));var t=this;this.$el.dialogS2({title:t.model.isNew()?NelioContent.i18n.titles.newTemplate:NelioContent.i18n.titles.editTemplate,buttons:e,draggable:!1,modal:!0,resizable:!1,width:Math.min(600,t._$window.width()-40),dialogClass:"nc-dialog",position:{my:"center top",at:"center top+60"},open:function(){t.listenTo(t,"nc:click:dialog:save",t._onDialogSave),t.listenTo(t,"nc:click:dialog:cancel",t._onDialogCancel),t.listenTo(t,"nc:click:dialog:delete",t._onDialogDelete),t._$saveButton=t.$el.parent().find("button.nc-save-button"),NelioContent.helpers.makeWarningTooltip(t._$saveButton);var e=t.$el.parent().find("button.nc-delete-button");e.length>0&&e.blur()},close:function(){t.stopListening(t,"nc:click:dialog:save",t._onDialogSave),t.stopListening(t,"nc:click:dialog:cancel",t._onDialogCancel),t.stopListening(t,"nc:click:dialog:delete",t._onDialogDelete),t._$saveButton.tooltip("destroy"),t._$saveButton=void 0,t._closeAndDestroy&&(t.$el.dialogS2("destroy"),t.trigger("nc:close:dialog"),t.close())}})},_maybeEnableSaveButton:function(){if("undefined"!=typeof this._$saveButton){this._$saveButton.tooltip("close");var e=this.model.isSomethingMissing();e?(this._$saveButton.addClass("button-disabled",!0),this._$saveButton.attr("title",e)):(this._$saveButton.removeClass("button-disabled",!1),this._$saveButton.attr("title",""))}},_onDialogSave:function(){if(!this.model.isSomethingMissing()){var e=this.$el.parent(),t=e.find(".ui-dialog-buttonpane button.button-primary"),i=e.find(".ui-dialog-titlebar button, .ui-dialog-buttonpane button:not( .button-primary )");this._lock(),this.$el.dialogS2("option","closeOnEscape",!1),t.prop("disabled",!0),i.prop("disabled",!0),t.html(NelioContent.i18n.feedback.saving);var n=this;this.model.save(void 0,{success:function(e,t){var i=new NelioContent.models.SocialTemplate(t);n.trigger("nc:save:template",i.toJSON()),n.$el.dialogS2("close")},error:function(e){n.$el.dialogS2("close")}})}},_onDialogCancel:function(){this.$el.dialogS2("close")},_onDialogDelete:function(){var e=this,t=NelioContent.helpers.openDeletionConfirmationDialog(NelioContent.i18n.titles.delSocialTemplate,NelioContent.i18n.dialogs.deleteSocialTemplate,NelioContent.i18n.actions.doDeleteTemplate,function(){var i=t.parent();i.find(".nc-super-delete-button").html(NelioContent.i18n.feedback.deleting),i.find("button").prop("disabled",!0),e.model.destroy({success:function(i,n){t.dialog("destroy"),e.trigger("nc:delete:template",e.model),e.$el.dialogS2("close")}})})},close:function(){NelioContent.profiles=this._originalProfileCollection,_.each(_.values(this._views),function(e){"object"==typeof e&&"function"==typeof e.close&&e.close()}),this.stopListening(),this.unbind(),"undefined"!=typeof this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),c=new NelioContent.views.SocialTemplateSettings({collection:NelioContent.templates}),h=e("#social-template-settings-container"),h.html(c.render().el)),_.contains(["social-profiles","social-templates"],n)||e("#submit").addClass("settings-ready")}(jQuery);